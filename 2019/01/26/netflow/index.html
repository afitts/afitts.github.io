<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>

<!-- Extra Header for IPython Notebooks
================================================== -->
  <link href="//cdn-images.mailchimp.com/embedcode/slim-081711.css" rel="stylesheet" type="text/css">
  <style type="text/css">
    #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif;  width:500px;}
    /*
      Add your own MailChimp form style overrides in your site stylesheet or in this style block.
      We recommend moving this block and the preceding CSS link to the HEAD of your HTML file.
     */
  </style>

	<!-- Basic Page Needs
  ================================================== -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="google-site-verification" content="AgIAQN_qsniIQWOq659Bnhzx-LZts2FdgP1kLgtQg-k" />
  <meta name="google-site-verification" content="-wneVy0z_MWocNaXikWZzyTe__HZbZDCRfLYEJ1sAg8" />

  <title>Training Autoencoders to Identify Normal and Abnormal Traffic Behavior in Netflow Data</title>

  <meta name="description" content="">
  <meta name="author" content="Alex Fitts">
  <meta name="copyright" content="&copy; Copyright Greg Reda, 2013 to Present">

  <!-- Mobile Specific Metas
  ================================================== -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- Fonts 
  ================================================== -->
  <link href='http://fonts.googleapis.com/css?family=Open+Sans|Merriweather|Source+Code+Pro' rel='stylesheet' type='text/css'>

  <!-- CSS
  ================================================== -->
  <link rel="stylesheet" href="/theme/css/style.min.css?cfc9322a">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <!-- Feeds
  ================================================== -->
  <link rel="alternate" type="application/atom+xml" href="http://afitts.github.io/feeds/all.atom.xml" title="Alex Fitts Full Atom Feed">

	<!-- Facebook Open Graph
  ================================================== -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Training Autoencoders to Identify Normal and Abnormal Traffic Behavior in Netflow Data">
  <meta property="og:url" content="http://afitts.github.io/2019/01/26/netflow/">
  <meta property="og:description" content="">
  <meta property="og:site_name" content="Alex Fitts">
  <meta property="og:image" content="http://afitts.github.io/theme/images/avatar.jpg">

  <!-- Twitter Cards
  ================================================== -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@Alex_Fitts">
  <meta name="twitter:creator" content="@Alex_Fitts">
  <meta name="twitter:domain" content="gregreda.com">
  <meta name="twitter:image" content="http://afitts.github.io/theme/images/avatar.jpg">
  <meta name="twitter:title" content="Training Autoencoders to Identify Normal and Abnormal Traffic Behavior in Netflow Data">
  <meta name="twitter:description" content="">

	<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->


	<!-- Favicons
	================================================== -->
	<link rel="shortcut icon" href="/theme/images/favicon.ico">
	<link rel="apple-touch-icon" href="/theme/images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/theme/images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/theme/images/apple-touch-icon-114x114.png">

</head>
<body>
	<!-- Primary Page Layout
	================================================== -->
	<div class="container">
<!-- Navigation
================================================== -->
<nav class="navbar">
  <div class="navbar-brand six columns"> <!-- Yes, I know this is a douchey class name -->
      <ul>
        <li>
          <a href="/" title="Home"><img id="logo" src="/theme/images/avatar.jpg"></a>
        </li>
        <li>
          <h1><a href="/" title="Home">Alex Fitts</a></h1>
        </li>
      </ul>
      <ul id="social-icons">
        <li>
          <a class="icon" href="https://twitter.com/Alex_Fitts" title="Twitter">
            <i class="fa fa-fw fa-twitter"></i>
          </a>
          </li>
        <li>
          <a class="icon" href="https://github.com/afitts" title="GitHub">
            <i class="fa fa-fw fa-github"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="https://www.linkedin.com/in/alex-fitts-64163b128/" title="LinkedIn">
            <i class="fa fa-fw fa-linkedin"></i>
          </a>
        </li>
      </ul> <!-- End social-icons ul -->
    </div> <!-- End navbar-brand -->

  <div class="navbar-links">
      <ul>
        <li><a href="/pub/">Publications</a></li>
        <li><a href="/talks/">Talks</a></li>
        <li><a href="/blog/">Blog</a></li>
	<li><a href="/pdfs/FittsResume.pdf">Resume</a></li>
        <!--        <li><a href="/coffee/">Coffee?</a></li> -->
      </ul> <!-- End navbar-links ul -->
    </div> <!-- End navbar-links -->
</nav> <!-- End navbar -->		<section id="content" class="twelve columns">

  <!-- Article Headers
  ================================================================== -->
  <h1 class="article-title"><a href="/2019/01/26/netflow/" title="Permalink to Training Autoencoders to Identify Normal and Abnormal Traffic Behavior in Netflow Data">Training Autoencoders to Identify Normal and Abnormal Traffic Behavior in Netflow Data</a></h1>
  <h5 class="article-date">January 26, 2019
  </h5>
  <hr class="small"></hr>

  <!-- Article Content
  ================================================================== -->
  <div class="article-content">
    <h2>Goal</h2>
<p>Train an autoencoder neural network to develop lower-dimensional representations of netflow data in an attempt to identify categories of behavior present within the data and effectively differentiate between abnormal and normal behavior.</p>
<p>Now when I say lower-dimensional representation (aka an embedding), what I mean by this is basically a fingerprint. So what I'm searching for is a way to take all the features of raw netflow data and really distill it down into key components that identify and classify the data.
<img alt="" src="https://media.istockphoto.com/videos/fingerprint-binary-code-video-id467425199?s=640x640"></p>
<h2>Intro to Unsupervised Learning and Autoencoders</h2>
<p>An autoencoder is a type of unsupervised learning algorithm. </p>
<p><strong>What do I mean by an unsupervised learning algorithm?</strong> 
An unsupervised learning algorithm takes in unlabeled or unclassified data, and attempts to develop its own labels/classifications. An easy way to think of this is showing an algorithm a bunch of images of cartoon characters but not telling the alogorithm which character is which. While training the algorithm, it attempts to place the characters into it's own groups based on the similarities inherent in each image. Below our algorithm has clearly discovered two beloved types of cartoon charaters: Duck and not-Duck!
<img alt="" src="https://miro.medium.com/max/1234/1*6hfFWPITJxbtw4ztoC1YeA.png"></p>
<p>Specifically, an autoencoder is a type of neural network algorithm that attempts to reproduce the input that is passed into its input layer. 
<img alt="alt text" src="https://cdn-images-1.medium.com/max/800/1*2ijh2-e0PcYgYKbWYkbdsw.png" title="From https://towardsdatascience.com/intuitively-understanding-variational-autoencoders-1bfe67eb5daf">
Initially this may sound unimpressive and indeed, if we allow our encoding to be the same size as the input, our algorithm could easily learn to simply memorize the input values!  </p>
<p><img alt="alt text" src="https://www.jeremyjordan.me/content/images/2018/03/Screen-Shot-2018-03-06-at-6.09.05-PM.png" title="From https://www.jeremyjordan.me/autoencoders/">
However, by imposing a bottleneck in the network we can force a compressed knowledge representation of the original input (i.e. we can boil the input data down to its essential pieces or its fingerprint). If the input features were each independent of one another, this compression and subsequent reconstruction would be a very difficult task. However, if some sort of structure exists in the data (ie. correlations between input features), this structure can be learned and consequently leveraged when forcing the input through the network's bottleneck.
<img alt="alt text" src="https://www.jeremyjordan.me/content/images/2018/03/Screen-Shot-2018-03-06-at-3.17.13-PM.png" title="From https://www.jeremyjordan.me/autoencoders/"></p>
<h2>Download the data</h2>
<p>The dataset I'll be using for this project is the LANL 2017 netflow dataset and focusing my initial analysis on day-03. There are about 6.1 million entries or 'events' that occur on day-03, each with 11 fields of data:</p>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">DIR</span> <span class="o">=</span> <span class="s">&quot;../input&quot;</span>

<span class="n">colnames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Time&#39;</span><span class="p">,</span> <span class="s">&#39;Duration&#39;</span><span class="p">,</span> <span class="s">&#39;SrcDevice&#39;</span><span class="p">,</span> <span class="s">&#39;DstDevice&#39;</span><span class="p">,</span> <span class="s">&#39;Protocol&#39;</span><span class="p">,</span> <span class="s">&#39;SrcPort&#39;</span><span class="p">,</span> <span class="s">&#39;DstPort&#39;</span><span class="p">,</span> <span class="s">&#39;SrcPackets&#39;</span><span class="p">,</span> 
       <span class="s">&#39;DstPackets&#39;</span><span class="p">,</span> <span class="s">&#39;SrcBytes&#39;</span><span class="p">,</span> <span class="s">&#39;DstBytes&#39;</span><span class="p">]</span>
<span class="n">cat_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;SrcDevice&#39;</span><span class="p">,</span> <span class="s">&#39;DstDevice&#39;</span><span class="p">,</span><span class="s">&#39;Protocol&#39;</span><span class="p">,</span><span class="s">&#39;SrcPort&#39;</span><span class="p">,</span> <span class="s">&#39;DstPort&#39;</span><span class="p">]</span>
<span class="n">cont_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Time&#39;</span><span class="p">,</span> <span class="s">&#39;Duration&#39;</span><span class="p">,</span> <span class="s">&#39;SrcPackets&#39;</span><span class="p">,</span> <span class="s">&#39;DstPackets&#39;</span><span class="p">,</span> <span class="s">&#39;SrcBytes&#39;</span><span class="p">,</span> <span class="s">&#39;DstBytes&#39;</span><span class="p">]</span>
<span class="n">train_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DIR</span><span class="p">,</span> <span class="s">&#39;netflow_day-03.csv&#39;</span><span class="p">),</span><span class="n">names</span> <span class="o">=</span> <span class="n">colnames</span><span class="p">)</span>
<span class="n">train_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Time</th>
      <th>Duration</th>
      <th>SrcDevice</th>
      <th>DstDevice</th>
      <th>Protocol</th>
      <th>SrcPort</th>
      <th>DstPort</th>
      <th>SrcPackets</th>
      <th>DstPackets</th>
      <th>SrcBytes</th>
      <th>DstBytes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>172800</td>
      <td>0</td>
      <td>Comp348305</td>
      <td>Comp370444</td>
      <td>6</td>
      <td>Port02726</td>
      <td>80</td>
      <td>0</td>
      <td>5</td>
      <td>0</td>
      <td>784</td>
    </tr>
    <tr>
      <th>1</th>
      <td>172800</td>
      <td>0</td>
      <td>Comp817584</td>
      <td>Comp275646</td>
      <td>17</td>
      <td>Port97545</td>
      <td>53</td>
      <td>1</td>
      <td>0</td>
      <td>77</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>172800</td>
      <td>0</td>
      <td>Comp654013</td>
      <td>Comp685925</td>
      <td>6</td>
      <td>Port26890</td>
      <td>Port94857</td>
      <td>6</td>
      <td>5</td>
      <td>1379</td>
      <td>1770</td>
    </tr>
    <tr>
      <th>3</th>
      <td>172800</td>
      <td>0</td>
      <td>Comp500631</td>
      <td>Comp275646</td>
      <td>17</td>
      <td>Port62938</td>
      <td>53</td>
      <td>1</td>
      <td>0</td>
      <td>64</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>172800</td>
      <td>0</td>
      <td>Comp500631</td>
      <td>Comp275646</td>
      <td>17</td>
      <td>Port52912</td>
      <td>53</td>
      <td>1</td>
      <td>0</td>
      <td>64</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span class="o">%</span><span class="n">wget</span> <span class="o">-</span><span class="n">c</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">csr</span><span class="o">.</span><span class="n">lanl</span><span class="o">.</span><span class="n">gov</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">unified</span><span class="o">-</span><span class="n">host</span><span class="o">-</span><span class="n">network</span><span class="o">-</span><span class="n">dataset</span><span class="o">-</span><span class="mi">2017</span><span class="o">/</span><span class="n">netflow</span><span class="o">/</span><span class="n">netflow_day</span><span class="o">-</span><span class="mf">03.</span><span class="n">bz2</span>
</pre></div>


<table>
<thead>
<tr>
<th>Field Name</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Time</td>
<td align="center">The start time of the event in epoch time format.</td>
</tr>
<tr>
<td>Duration</td>
<td align="center">The duration of the event in seconds.</td>
</tr>
<tr>
<td>SrcDevice</td>
<td align="center">The device that likely initiated the event.</td>
</tr>
<tr>
<td>DstDevice</td>
<td align="center">The receiving device.</td>
</tr>
<tr>
<td>Protocol</td>
<td align="center">The protocol number.</td>
</tr>
<tr>
<td>SrcPort</td>
<td align="center">The port used by the SrcDevice.</td>
</tr>
<tr>
<td>DstPort</td>
<td align="center">The port used by the DstDevice.</td>
</tr>
<tr>
<td>SrcPackets</td>
<td align="center">The number of packets the SrcDevice sent during the event.</td>
</tr>
<tr>
<td>DstPackets</td>
<td align="center">The number of packets the DstDevice sent during the event.</td>
</tr>
<tr>
<td>SrcBytes</td>
<td align="center">The number of bytes the SrcDevice sent during the event.</td>
</tr>
<tr>
<td>DstBytes</td>
<td align="center">The number of bytes the DstDevice sent during the event.</td>
</tr>
</tbody>
</table>
<h2>Load the data</h2>
<p>Each day of the LANL netflow data ends in an incomplete line. Hence attempting a simple <code>bunzip2</code> will result in a failure. To work around this issue we can use <code>bzip2recover</code> on the file, use <code>bzip2</code> to unzip the individual blocks and stich them together into a single csv file and finally use a quick bash command to remove the corrupted final line.</p>
<div class="highlight"><pre><span class="o">%</span><span class="n">bzip2recover</span> <span class="n">netflow_day</span><span class="o">-</span><span class="mf">03.</span><span class="n">bz2</span>
<span class="o">%</span><span class="n">bzip2</span> <span class="o">-</span><span class="n">dc</span> <span class="n">rec00</span><span class="o">*</span> <span class="o">&gt;</span> <span class="n">netflow_day</span><span class="o">-</span><span class="mf">03.</span><span class="n">csv</span>
<span class="o">%</span><span class="n">head</span> <span class="o">-</span><span class="n">n</span> <span class="o">-</span><span class="mi">1</span> <span class="n">netflow_day</span><span class="o">-</span><span class="mf">03.</span><span class="n">csv</span> <span class="o">&gt;</span> <span class="n">temp</span><span class="o">.</span><span class="n">txt</span> <span class="p">;</span> <span class="n">mv</span> <span class="n">temp</span><span class="o">.</span><span class="n">txt</span> <span class="n">netflow_day</span><span class="o">-</span><span class="mf">03.</span><span class="n">csv</span>
<span class="o">%</span><span class="n">mkdir</span> <span class="o">../</span><span class="nb">input</span>
<span class="o">%</span><span class="n">mv</span> <span class="n">netflow_day</span><span class="o">-</span><span class="mf">03.</span><span class="n">csv</span> <span class="o">../</span><span class="nb">input</span><span class="o">/</span>
</pre></div>


<h2>Data Exploration</h2>
<h3>Initial look</h3>
<div class="highlight"><pre><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">math</span>
</pre></div>


<table>
<thead>
<tr>
<th>Field Name</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Time</td>
<td align="center">The start time of the event in epoch time format.</td>
</tr>
<tr>
<td>Duration</td>
<td align="center">The duration of the event in seconds.</td>
</tr>
<tr>
<td>SrcDevice</td>
<td align="center">The device that likely initiated the event.</td>
</tr>
<tr>
<td>DstDevice</td>
<td align="center">The receiving device.</td>
</tr>
<tr>
<td>Protocol</td>
<td align="center">The protocol number.</td>
</tr>
<tr>
<td>SrcPort</td>
<td align="center">The port used by the SrcDevice.</td>
</tr>
<tr>
<td>DstPort</td>
<td align="center">The port used by the DstDevice.</td>
</tr>
<tr>
<td>SrcPackets</td>
<td align="center">The number of packets the SrcDevice sent during the event.</td>
</tr>
<tr>
<td>DstPackets</td>
<td align="center">The number of packets the DstDevice sent during the event.</td>
</tr>
<tr>
<td>SrcBytes</td>
<td align="center">The number of bytes the SrcDevice sent during the event.</td>
</tr>
<tr>
<td>DstBytes</td>
<td align="center">The number of bytes the DstDevice sent during the event.</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span class="n">DIR</span> <span class="o">=</span> <span class="s">&quot;../input&quot;</span>

<span class="n">colnames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Time&#39;</span><span class="p">,</span> <span class="s">&#39;Duration&#39;</span><span class="p">,</span> <span class="s">&#39;SrcDevice&#39;</span><span class="p">,</span> <span class="s">&#39;DstDevice&#39;</span><span class="p">,</span> <span class="s">&#39;Protocol&#39;</span><span class="p">,</span> <span class="s">&#39;SrcPort&#39;</span><span class="p">,</span> <span class="s">&#39;DstPort&#39;</span><span class="p">,</span> <span class="s">&#39;SrcPackets&#39;</span><span class="p">,</span> 
       <span class="s">&#39;DstPackets&#39;</span><span class="p">,</span> <span class="s">&#39;SrcBytes&#39;</span><span class="p">,</span> <span class="s">&#39;DstBytes&#39;</span><span class="p">]</span>
<span class="n">cat_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;SrcDevice&#39;</span><span class="p">,</span> <span class="s">&#39;DstDevice&#39;</span><span class="p">,</span><span class="s">&#39;Protocol&#39;</span><span class="p">,</span><span class="s">&#39;SrcPort&#39;</span><span class="p">,</span> <span class="s">&#39;DstPort&#39;</span><span class="p">]</span>
<span class="n">cont_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Time&#39;</span><span class="p">,</span> <span class="s">&#39;Duration&#39;</span><span class="p">,</span> <span class="s">&#39;SrcPackets&#39;</span><span class="p">,</span> <span class="s">&#39;DstPackets&#39;</span><span class="p">,</span> <span class="s">&#39;SrcBytes&#39;</span><span class="p">,</span> <span class="s">&#39;DstBytes&#39;</span><span class="p">]</span>
<span class="n">train_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DIR</span><span class="p">,</span> <span class="s">&#39;netflow_day-03.csv&#39;</span><span class="p">),</span><span class="n">names</span> <span class="o">=</span> <span class="n">colnames</span><span class="p">)</span>
</pre></div>


<p>We've got a little over 6.1 million events occuring during day-03 in our dataset.</p>
<div class="highlight"><pre><span class="n">train_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>


<div class="highlight"><pre>(6102087, 11)
</pre></div>


<div class="highlight"><pre><span class="n">train_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Time</th>
      <th>Duration</th>
      <th>SrcDevice</th>
      <th>DstDevice</th>
      <th>Protocol</th>
      <th>SrcPort</th>
      <th>DstPort</th>
      <th>SrcPackets</th>
      <th>DstPackets</th>
      <th>SrcBytes</th>
      <th>DstBytes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>172800</td>
      <td>0</td>
      <td>Comp348305</td>
      <td>Comp370444</td>
      <td>6</td>
      <td>Port02726</td>
      <td>80</td>
      <td>0</td>
      <td>5</td>
      <td>0</td>
      <td>784</td>
    </tr>
    <tr>
      <th>1</th>
      <td>172800</td>
      <td>0</td>
      <td>Comp817584</td>
      <td>Comp275646</td>
      <td>17</td>
      <td>Port97545</td>
      <td>53</td>
      <td>1</td>
      <td>0</td>
      <td>77</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>172800</td>
      <td>0</td>
      <td>Comp654013</td>
      <td>Comp685925</td>
      <td>6</td>
      <td>Port26890</td>
      <td>Port94857</td>
      <td>6</td>
      <td>5</td>
      <td>1379</td>
      <td>1770</td>
    </tr>
    <tr>
      <th>3</th>
      <td>172800</td>
      <td>0</td>
      <td>Comp500631</td>
      <td>Comp275646</td>
      <td>17</td>
      <td>Port62938</td>
      <td>53</td>
      <td>1</td>
      <td>0</td>
      <td>64</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>172800</td>
      <td>0</td>
      <td>Comp500631</td>
      <td>Comp275646</td>
      <td>17</td>
      <td>Port52912</td>
      <td>53</td>
      <td>1</td>
      <td>0</td>
      <td>64</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<p>Let's get an idea of the number of unique values for a few of the features.  <code>SrcDevice</code> and <code>DstDevice</code> each have roughly 19K unique values. <code>SrcPort</code> has roughly 65K unique values while <code>DstPort</code> has roughly 40K unique values. </p>
<p>(Technical Aside: This high cardinality means its difficult to take advantage of a one-hot-encoding scheme for these 4 variables although we will be able to break apart <code>SrcDevice</code> and <code>DstDevice</code> for some more information as I will show below. <strong>Question: Are Comp/IP/Port numbers near one another are related in their uses?</strong> For now I'll treat them as categorical. Protocol only has 3 different values, so we can easily one-hot-encode that variable (1=ICMP Internet Control Message, 6=TCP Transmission Control, 17=UDP User Datagram).) </p>
<h3><code>SrcDevice</code> and <code>DstDevice</code></h3>
<h4>There are 6 general categories of Devices: <code>Comp</code>, <code>IP</code>, <code>ActiveDirectory</code>, <code>EnterpriseAppServer</code>, <code>VPN</code> and <code>VScanner</code>.</h4>
<div class="highlight"><pre><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;SrcDevice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&#39;category&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span>
</pre></div>


<div class="highlight"><pre>Index([&#39;ActiveDirectory&#39;, &#39;Comp000116&#39;, &#39;Comp000156&#39;, &#39;Comp000219&#39;,
       &#39;Comp000566&#39;, &#39;Comp000573&#39;, &#39;Comp000577&#39;, &#39;Comp000688&#39;, &#39;Comp000696&#39;,
       &#39;Comp000775&#39;,
       ...
       &#39;IP998111&#39;, &#39;IP998491&#39;, &#39;IP998759&#39;, &#39;IP998823&#39;, &#39;IP999095&#39;, &#39;IP999633&#39;,
       &#39;IP999839&#39;, &#39;IP999955&#39;, &#39;VPN&#39;, &#39;VScanner&#39;],
      dtype=&#39;object&#39;, length=18950)
</pre></div>


<div class="highlight"><pre><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;DstDevice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&#39;category&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span>
</pre></div>


<div class="highlight"><pre>Index([&#39;ActiveDirectory&#39;, &#39;Comp000190&#39;, &#39;Comp000244&#39;, &#39;Comp000332&#39;,
       &#39;Comp000346&#39;, &#39;Comp000386&#39;, &#39;Comp000575&#39;, &#39;Comp000595&#39;, &#39;Comp000688&#39;,
       &#39;Comp000944&#39;,
       ...
       &#39;IP999711&#39;, &#39;IP999776&#39;, &#39;IP999780&#39;, &#39;IP999852&#39;, &#39;IP999875&#39;, &#39;IP999896&#39;,
       &#39;IP999935&#39;, &#39;IP999949&#39;, &#39;VPN&#39;, &#39;VScanner&#39;],
      dtype=&#39;object&#39;, length=18921)
</pre></div>


<p>There are a few other Devices beyond Comps and IPs.</p>
<div class="highlight"><pre><span class="n">noComp_orIP</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[</span><span class="s">&#39;SrcDevice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;SrcDevice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#39;Comp&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">)</span> <span class="o">&amp;</span>
                          <span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;SrcDevice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s">&#39;IP&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">False</span><span class="p">)]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&#39;category&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span>
<span class="k">print</span><span class="p">(</span><span class="n">noComp_orIP</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>Index([&#39;ActiveDirectory&#39;, &#39;EnterpriseAppServer&#39;, &#39;VPN&#39;, &#39;VScanner&#39;], dtype=&#39;object&#39;)
</pre></div>


<h4>The majority (98%) of events appear to have a <code>SrcDevice</code> that is a Comp. The next closest Device is the <code>EnterpriseAppServer</code> at 1.37% of events. It's also interesting to note that 8 Comps are the <code>SrcDevice</code> of nearly half the data.</h4>
<div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="s">&#39;Events</span><span class="se">\&#39;</span><span class="s"> SrcDevice Breakdown&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Comp&#39;</span><span class="p">,</span><span class="s">&#39;IP&#39;</span><span class="p">,</span><span class="s">&#39;ActiveDirectory&#39;</span><span class="p">,</span> <span class="s">&#39;EnterpriseAppServer&#39;</span><span class="p">,</span> <span class="s">&#39;VPN&#39;</span><span class="p">,</span> <span class="s">&#39;VScanner&#39;</span><span class="p">]:</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[</span><span class="s">&#39;SrcDevice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;SrcDevice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">f</span><span class="s">&#39;{i}&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">True</span><span class="p">)]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">/</span><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;Time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">tmp</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>SrcDevice Breakdown
Comp 0.9766106251844656
IP 0.0033899877205946097
ActiveDirectory 0.0014785105489318654
EnterpriseAppServer 0.013733498063859135
VPN 0.0011150283501366008
VScanner 0.0036723501320122115
</pre></div>


<div class="highlight"><pre><span class="n">counted</span> <span class="o">=</span> <span class="n">train_df1</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&quot;SrcDevice_Comp&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;Time&quot;</span><span class="p">:</span><span class="s">&quot;SrcDevice_count&quot;</span><span class="p">})</span>
<span class="n">counted</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;SrcDevice_count&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SrcDevice_count</th>
      <th>Duration</th>
      <th>SrcPort</th>
      <th>DstPort</th>
      <th>SrcPackets</th>
      <th>DstPackets</th>
      <th>SrcBytes</th>
      <th>DstBytes</th>
      <th>DstDevice_Comp</th>
      <th>SrcDevice_IP</th>
      <th>...</th>
      <th>DstDevice_ActiveDirectory</th>
      <th>SrcDevice_EnterpriseAppServer</th>
      <th>DstDevice_EnterpriseAppServer</th>
      <th>SrcDevice_VPN</th>
      <th>DstDevice_VPN</th>
      <th>SrcDevice_VScanner</th>
      <th>DstDevice_VScanner</th>
      <th>Protocol_1</th>
      <th>Protocol_6</th>
      <th>Protocol_17</th>
    </tr>
    <tr>
      <th>SrcDevice_Comp</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>44772</th>
      <td>412110</td>
      <td>412110</td>
      <td>412110</td>
      <td>412110</td>
      <td>412110</td>
      <td>412110</td>
      <td>412110</td>
      <td>412110</td>
      <td>412110</td>
      <td>412110</td>
      <td>...</td>
      <td>412110</td>
      <td>412110</td>
      <td>412110</td>
      <td>412110</td>
      <td>412110</td>
      <td>412110</td>
      <td>412110</td>
      <td>412110</td>
      <td>412110</td>
      <td>412110</td>
    </tr>
    <tr>
      <th>296454</th>
      <td>396393</td>
      <td>396393</td>
      <td>396393</td>
      <td>396393</td>
      <td>396393</td>
      <td>396393</td>
      <td>396393</td>
      <td>396393</td>
      <td>396393</td>
      <td>396393</td>
      <td>...</td>
      <td>396393</td>
      <td>396393</td>
      <td>396393</td>
      <td>396393</td>
      <td>396393</td>
      <td>396393</td>
      <td>396393</td>
      <td>396393</td>
      <td>396393</td>
      <td>396393</td>
    </tr>
    <tr>
      <th>623258</th>
      <td>376489</td>
      <td>376489</td>
      <td>376489</td>
      <td>376489</td>
      <td>376489</td>
      <td>376489</td>
      <td>376489</td>
      <td>376489</td>
      <td>376489</td>
      <td>376489</td>
      <td>...</td>
      <td>376489</td>
      <td>376489</td>
      <td>376489</td>
      <td>376489</td>
      <td>376489</td>
      <td>376489</td>
      <td>376489</td>
      <td>376489</td>
      <td>376489</td>
      <td>376489</td>
    </tr>
    <tr>
      <th>73202</th>
      <td>355912</td>
      <td>355912</td>
      <td>355912</td>
      <td>355912</td>
      <td>355912</td>
      <td>355912</td>
      <td>355912</td>
      <td>355912</td>
      <td>355912</td>
      <td>355912</td>
      <td>...</td>
      <td>355912</td>
      <td>355912</td>
      <td>355912</td>
      <td>355912</td>
      <td>355912</td>
      <td>355912</td>
      <td>355912</td>
      <td>355912</td>
      <td>355912</td>
      <td>355912</td>
    </tr>
    <tr>
      <th>30334</th>
      <td>343163</td>
      <td>343163</td>
      <td>343163</td>
      <td>343163</td>
      <td>343163</td>
      <td>343163</td>
      <td>343163</td>
      <td>343163</td>
      <td>343163</td>
      <td>343163</td>
      <td>...</td>
      <td>343163</td>
      <td>343163</td>
      <td>343163</td>
      <td>343163</td>
      <td>343163</td>
      <td>343163</td>
      <td>343163</td>
      <td>343163</td>
      <td>343163</td>
      <td>343163</td>
    </tr>
    <tr>
      <th>866402</th>
      <td>342651</td>
      <td>342651</td>
      <td>342651</td>
      <td>342651</td>
      <td>342651</td>
      <td>342651</td>
      <td>342651</td>
      <td>342651</td>
      <td>342651</td>
      <td>342651</td>
      <td>...</td>
      <td>342651</td>
      <td>342651</td>
      <td>342651</td>
      <td>342651</td>
      <td>342651</td>
      <td>342651</td>
      <td>342651</td>
      <td>342651</td>
      <td>342651</td>
      <td>342651</td>
    </tr>
    <tr>
      <th>257274</th>
      <td>342549</td>
      <td>342549</td>
      <td>342549</td>
      <td>342549</td>
      <td>342549</td>
      <td>342549</td>
      <td>342549</td>
      <td>342549</td>
      <td>342549</td>
      <td>342549</td>
      <td>...</td>
      <td>342549</td>
      <td>342549</td>
      <td>342549</td>
      <td>342549</td>
      <td>342549</td>
      <td>342549</td>
      <td>342549</td>
      <td>342549</td>
      <td>342549</td>
      <td>342549</td>
    </tr>
    <tr>
      <th>965575</th>
      <td>337894</td>
      <td>337894</td>
      <td>337894</td>
      <td>337894</td>
      <td>337894</td>
      <td>337894</td>
      <td>337894</td>
      <td>337894</td>
      <td>337894</td>
      <td>337894</td>
      <td>...</td>
      <td>337894</td>
      <td>337894</td>
      <td>337894</td>
      <td>337894</td>
      <td>337894</td>
      <td>337894</td>
      <td>337894</td>
      <td>337894</td>
      <td>337894</td>
      <td>337894</td>
    </tr>
    <tr>
      <th>0</th>
      <td>142724</td>
      <td>142724</td>
      <td>142724</td>
      <td>142724</td>
      <td>142724</td>
      <td>142724</td>
      <td>142724</td>
      <td>142724</td>
      <td>142724</td>
      <td>142724</td>
      <td>...</td>
      <td>142724</td>
      <td>142724</td>
      <td>142724</td>
      <td>142724</td>
      <td>142724</td>
      <td>142724</td>
      <td>142724</td>
      <td>142724</td>
      <td>142724</td>
      <td>142724</td>
    </tr>
    <tr>
      <th>107130</th>
      <td>97940</td>
      <td>97940</td>
      <td>97940</td>
      <td>97940</td>
      <td>97940</td>
      <td>97940</td>
      <td>97940</td>
      <td>97940</td>
      <td>97940</td>
      <td>97940</td>
      <td>...</td>
      <td>97940</td>
      <td>97940</td>
      <td>97940</td>
      <td>97940</td>
      <td>97940</td>
      <td>97940</td>
      <td>97940</td>
      <td>97940</td>
      <td>97940</td>
      <td>97940</td>
    </tr>
  </tbody>
</table>
<p>10 rows × 22 columns</p>
</div>

<h4>While the majority of events have a Comp for their <code>DstDevice</code> (86.61%), <code>ActiveDirectory</code> and <code>EnterpriseAppServer</code> have a larger share than for the <code>SrcDevice</code> (7.14% and 5.85% respectively).</h4>
<div class="highlight"><pre><span class="k">print</span><span class="p">(</span><span class="s">&#39;Events</span><span class="se">\&#39;</span><span class="s"> DstDevice Breakdown&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Comp&#39;</span><span class="p">,</span><span class="s">&#39;IP&#39;</span><span class="p">,</span><span class="s">&#39;ActiveDirectory&#39;</span><span class="p">,</span> <span class="s">&#39;EnterpriseAppServer&#39;</span><span class="p">,</span> <span class="s">&#39;VPN&#39;</span><span class="p">,</span> <span class="s">&#39;VScanner&#39;</span><span class="p">]:</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[</span><span class="s">&#39;DstDevice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;DstDevice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">f</span><span class="s">&#39;{i}&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">True</span><span class="p">)]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">/</span><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;Time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">tmp</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>DstDevice Breakdown
Comp 0.8661133477775719
IP 0.0035854946020926937
ActiveDirectory 0.07141753305057762
EnterpriseAppServer 0.05854111880082995
VPN 0.00013454413219608308
VScanner 0.00020796163673182633
</pre></div>


<div class="highlight"><pre><span class="n">counted</span> <span class="o">=</span> <span class="n">train_df1</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&quot;DstDevice_Comp&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;Time&quot;</span><span class="p">:</span><span class="s">&quot;DstDevice_count&quot;</span><span class="p">})</span>
<span class="n">counted</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;DstDevice_count&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DstDevice_count</th>
      <th>Duration</th>
      <th>SrcPort</th>
      <th>DstPort</th>
      <th>SrcPackets</th>
      <th>DstPackets</th>
      <th>SrcBytes</th>
      <th>DstBytes</th>
      <th>SrcDevice_Comp</th>
      <th>SrcDevice_IP</th>
      <th>...</th>
      <th>DstDevice_ActiveDirectory</th>
      <th>SrcDevice_EnterpriseAppServer</th>
      <th>DstDevice_EnterpriseAppServer</th>
      <th>SrcDevice_VPN</th>
      <th>DstDevice_VPN</th>
      <th>SrcDevice_VScanner</th>
      <th>DstDevice_VScanner</th>
      <th>Protocol_1</th>
      <th>Protocol_6</th>
      <th>Protocol_17</th>
    </tr>
    <tr>
      <th>DstDevice_Comp</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>816988</td>
      <td>816988</td>
      <td>816988</td>
      <td>816988</td>
      <td>816988</td>
      <td>816988</td>
      <td>816988</td>
      <td>816988</td>
      <td>816988</td>
      <td>816988</td>
      <td>...</td>
      <td>816988</td>
      <td>816988</td>
      <td>816988</td>
      <td>816988</td>
      <td>816988</td>
      <td>816988</td>
      <td>816988</td>
      <td>816988</td>
      <td>816988</td>
      <td>816988</td>
    </tr>
    <tr>
      <th>275646</th>
      <td>624576</td>
      <td>624576</td>
      <td>624576</td>
      <td>624576</td>
      <td>624576</td>
      <td>624576</td>
      <td>624576</td>
      <td>624576</td>
      <td>624576</td>
      <td>624576</td>
      <td>...</td>
      <td>624576</td>
      <td>624576</td>
      <td>624576</td>
      <td>624576</td>
      <td>624576</td>
      <td>624576</td>
      <td>624576</td>
      <td>624576</td>
      <td>624576</td>
      <td>624576</td>
    </tr>
    <tr>
      <th>576031</th>
      <td>218410</td>
      <td>218410</td>
      <td>218410</td>
      <td>218410</td>
      <td>218410</td>
      <td>218410</td>
      <td>218410</td>
      <td>218410</td>
      <td>218410</td>
      <td>218410</td>
      <td>...</td>
      <td>218410</td>
      <td>218410</td>
      <td>218410</td>
      <td>218410</td>
      <td>218410</td>
      <td>218410</td>
      <td>218410</td>
      <td>218410</td>
      <td>218410</td>
      <td>218410</td>
    </tr>
    <tr>
      <th>576843</th>
      <td>193316</td>
      <td>193316</td>
      <td>193316</td>
      <td>193316</td>
      <td>193316</td>
      <td>193316</td>
      <td>193316</td>
      <td>193316</td>
      <td>193316</td>
      <td>193316</td>
      <td>...</td>
      <td>193316</td>
      <td>193316</td>
      <td>193316</td>
      <td>193316</td>
      <td>193316</td>
      <td>193316</td>
      <td>193316</td>
      <td>193316</td>
      <td>193316</td>
      <td>193316</td>
    </tr>
    <tr>
      <th>186884</th>
      <td>145802</td>
      <td>145802</td>
      <td>145802</td>
      <td>145802</td>
      <td>145802</td>
      <td>145802</td>
      <td>145802</td>
      <td>145802</td>
      <td>145802</td>
      <td>145802</td>
      <td>...</td>
      <td>145802</td>
      <td>145802</td>
      <td>145802</td>
      <td>145802</td>
      <td>145802</td>
      <td>145802</td>
      <td>145802</td>
      <td>145802</td>
      <td>145802</td>
      <td>145802</td>
    </tr>
    <tr>
      <th>916004</th>
      <td>66911</td>
      <td>66911</td>
      <td>66911</td>
      <td>66911</td>
      <td>66911</td>
      <td>66911</td>
      <td>66911</td>
      <td>66911</td>
      <td>66911</td>
      <td>66911</td>
      <td>...</td>
      <td>66911</td>
      <td>66911</td>
      <td>66911</td>
      <td>66911</td>
      <td>66911</td>
      <td>66911</td>
      <td>66911</td>
      <td>66911</td>
      <td>66911</td>
      <td>66911</td>
    </tr>
    <tr>
      <th>63824</th>
      <td>63126</td>
      <td>63126</td>
      <td>63126</td>
      <td>63126</td>
      <td>63126</td>
      <td>63126</td>
      <td>63126</td>
      <td>63126</td>
      <td>63126</td>
      <td>63126</td>
      <td>...</td>
      <td>63126</td>
      <td>63126</td>
      <td>63126</td>
      <td>63126</td>
      <td>63126</td>
      <td>63126</td>
      <td>63126</td>
      <td>63126</td>
      <td>63126</td>
      <td>63126</td>
    </tr>
    <tr>
      <th>393033</th>
      <td>44319</td>
      <td>44319</td>
      <td>44319</td>
      <td>44319</td>
      <td>44319</td>
      <td>44319</td>
      <td>44319</td>
      <td>44319</td>
      <td>44319</td>
      <td>44319</td>
      <td>...</td>
      <td>44319</td>
      <td>44319</td>
      <td>44319</td>
      <td>44319</td>
      <td>44319</td>
      <td>44319</td>
      <td>44319</td>
      <td>44319</td>
      <td>44319</td>
      <td>44319</td>
    </tr>
    <tr>
      <th>501516</th>
      <td>43614</td>
      <td>43614</td>
      <td>43614</td>
      <td>43614</td>
      <td>43614</td>
      <td>43614</td>
      <td>43614</td>
      <td>43614</td>
      <td>43614</td>
      <td>43614</td>
      <td>...</td>
      <td>43614</td>
      <td>43614</td>
      <td>43614</td>
      <td>43614</td>
      <td>43614</td>
      <td>43614</td>
      <td>43614</td>
      <td>43614</td>
      <td>43614</td>
      <td>43614</td>
    </tr>
    <tr>
      <th>995183</th>
      <td>37139</td>
      <td>37139</td>
      <td>37139</td>
      <td>37139</td>
      <td>37139</td>
      <td>37139</td>
      <td>37139</td>
      <td>37139</td>
      <td>37139</td>
      <td>37139</td>
      <td>...</td>
      <td>37139</td>
      <td>37139</td>
      <td>37139</td>
      <td>37139</td>
      <td>37139</td>
      <td>37139</td>
      <td>37139</td>
      <td>37139</td>
      <td>37139</td>
      <td>37139</td>
    </tr>
  </tbody>
</table>
<p>10 rows × 22 columns</p>
</div>

<h4>There doesn't seem to be anything particularly interesting in the distribution of Comp numbers for <code>SrcDevice</code> or <code>DstDevice</code>. Again we see that a select few Comps have a majoirty of the traffic.</h4>
<div class="highlight"><pre><span class="n">num_bins</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">train_df1</span><span class="p">[</span><span class="s">&#39;SrcDevice_Comp&#39;</span><span class="p">],</span> <span class="n">num_bins</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre>/home/paperspace/anaconda3/envs/fastaiv1/lib/python3.7/site-packages/matplotlib/axes/_axes.py:6510: MatplotlibDeprecationWarning: 
The &#39;normed&#39; kwarg was deprecated in Matplotlib 2.1 and will be removed in 3.1. Use &#39;density&#39; instead.
  alternative=&quot;&#39;density&#39;&quot;, removal=&quot;3.1&quot;)
</pre></div>


<p><img alt="png" src="Punch-netflow-project_files/Punch-netflow-project_35_1.png"></p>
<div class="highlight"><pre><span class="n">num_bins</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">train_df1</span><span class="p">[</span><span class="s">&#39;DstDevice_Comp&#39;</span><span class="p">],</span> <span class="n">num_bins</span><span class="p">,</span> <span class="n">normed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre>/home/paperspace/anaconda3/envs/fastaiv1/lib/python3.7/site-packages/matplotlib/axes/_axes.py:6510: MatplotlibDeprecationWarning: 
The &#39;normed&#39; kwarg was deprecated in Matplotlib 2.1 and will be removed in 3.1. Use &#39;density&#39; instead.
  alternative=&quot;&#39;density&#39;&quot;, removal=&quot;3.1&quot;)
</pre></div>


<p><img alt="png" src="Punch-netflow-project_files/Punch-netflow-project_36_1.png"></p>
<div class="highlight"><pre><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mf">1e4</span><span class="p">:</span>
        <span class="n">counted</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">counted</span><span class="p">[</span><span class="s">&quot;SrcDevice_count&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">counted</span><span class="p">[</span><span class="s">&quot;SrcDevice_count&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">i</span><span class="o">*</span><span class="mi">10</span><span class="p">),</span><span class="s">&#39;SrcDevice_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">counted</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">counted</span><span class="p">[</span><span class="s">&quot;SrcDevice_count&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">i</span><span class="p">,</span><span class="s">&#39;SrcDevice_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">counted</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s">&quot;SrcDevice_count&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="Punch-netflow-project_files/Punch-netflow-project_37_0.png"></p>
<p>Looking at the distribution of <code>SrcDevice</code>, it appears that the majority (98.401%) of <code>SrcDevices</code> are used anywhere from 1 to 1000 times but only accoutn for a quarter the data! Another quarter of the data account for 1.557% <code>SrcDevices</code> used between 1000 and 1e5 times and nearly half of the data originates from 0.042% (8!!) of <code>SrcDevices</code>.</p>
<div class="highlight"><pre><span class="n">counted</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&quot;DstDevice&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;Time&quot;</span><span class="p">:</span><span class="s">&quot;DstDevice_count&quot;</span><span class="p">})</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mf">1e4</span><span class="p">:</span>
        <span class="n">counted</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">counted</span><span class="p">[</span><span class="s">&quot;DstDevice_count&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">counted</span><span class="p">[</span><span class="s">&quot;DstDevice_count&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">i</span><span class="o">*</span><span class="mi">10</span><span class="p">),</span><span class="s">&#39;DstDevice_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">counted</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">counted</span><span class="p">[</span><span class="s">&quot;DstDevice_count&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">i</span><span class="p">,</span><span class="s">&#39;DstDevice_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">counted</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s">&quot;DstDevice_count&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="Punch-netflow-project_files/Punch-netflow-project_39_0.png"></p>
<div class="highlight"><pre><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">counted</span><span class="p">[</span><span class="s">&#39;Duration&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">counted</span><span class="p">[</span><span class="s">&#39;Duration&#39;</span><span class="p">]</span><span class="o">&gt;</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre>10.0 10997
100.0 6131
1000.0 303
</pre></div>


<div class="highlight"><pre><span class="n">train_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Time</th>
      <th>Duration</th>
      <th>SrcDevice</th>
      <th>DstDevice</th>
      <th>Protocol</th>
      <th>SrcPort</th>
      <th>DstPort</th>
      <th>SrcPackets</th>
      <th>DstPackets</th>
      <th>SrcBytes</th>
      <th>DstBytes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>172800</td>
      <td>0</td>
      <td>4420</td>
      <td>2456</td>
      <td>1</td>
      <td>1926</td>
      <td>224</td>
      <td>0</td>
      <td>5</td>
      <td>0</td>
      <td>784</td>
    </tr>
    <tr>
      <th>1</th>
      <td>172800</td>
      <td>0</td>
      <td>10428</td>
      <td>1828</td>
      <td>2</td>
      <td>63323</td>
      <td>155</td>
      <td>1</td>
      <td>0</td>
      <td>77</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>172800</td>
      <td>0</td>
      <td>8268</td>
      <td>4593</td>
      <td>1</td>
      <td>17434</td>
      <td>37537</td>
      <td>6</td>
      <td>5</td>
      <td>1379</td>
      <td>1770</td>
    </tr>
    <tr>
      <th>3</th>
      <td>172800</td>
      <td>0</td>
      <td>6348</td>
      <td>1828</td>
      <td>2</td>
      <td>40895</td>
      <td>155</td>
      <td>1</td>
      <td>0</td>
      <td>64</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>172800</td>
      <td>0</td>
      <td>6348</td>
      <td>1828</td>
      <td>2</td>
      <td>34386</td>
      <td>155</td>
      <td>1</td>
      <td>0</td>
      <td>64</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<h4>Attempt at showing clusters of devices through a flow graph (Work in progress!!)</h4>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">igraph</span> <span class="kn">as</span> <span class="nn">ig</span>
<span class="n">train_df0</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DIR</span><span class="p">,</span> <span class="s">&#39;netflow_day-03.csv&#39;</span><span class="p">),</span><span class="n">names</span> <span class="o">=</span> <span class="n">colnames</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span class="n">flow</span> <span class="o">=</span> <span class="n">train_df0</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s">&#39;SrcDevice&#39;</span><span class="p">,</span><span class="s">&#39;DstDevice&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s">&#39;count&#39;</span><span class="p">})</span>
</pre></div>


<div class="highlight"><pre><span class="n">computer_edgelist</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">tuple</span><span class="p">,</span><span class="n">flow</span><span class="p">[[</span><span class="s">&#39;SrcDevice&#39;</span><span class="p">,</span><span class="s">&#39;DstDevice&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span><span class="n">flow</span><span class="p">[</span><span class="s">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
</pre></div>


<div class="highlight"><pre><span class="n">src_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">computer_edgelist</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
<span class="n">dst_set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">computer_edgelist</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

<span class="k">print</span><span class="p">(</span><span class="s">&quot;Sources:     &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_set</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Destinations: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">dst_set</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Union:       &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">dst_set</span><span class="p">)))</span>
<span class="k">print</span><span class="p">(</span><span class="s">&quot;Intersection: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_set</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">dst_set</span><span class="p">)))</span>
</pre></div>


<div class="highlight"><pre><span class="n">Sources</span><span class="o">:</span>      <span class="mi">18950</span>
<span class="n">Destinations</span><span class="o">:</span>  <span class="mi">18921</span>
<span class="n">Union</span><span class="o">:</span>        <span class="mi">34019</span>
<span class="n">Intersection</span><span class="o">:</span>  <span class="mi">3852</span>
</pre></div>


<div class="highlight"><pre><span class="n">nv</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">dst_set</span><span class="p">))</span>
<span class="n">vlookup</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">nv</span><span class="p">),</span> <span class="nb">list</span><span class="p">(</span><span class="n">src_set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">dst_set</span><span class="p">))))</span>
<span class="n">ilookup</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">src_set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">dst_set</span><span class="p">)),</span> <span class="nb">range</span><span class="p">(</span><span class="n">nv</span><span class="p">)))</span>
<span class="n">elist</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ilookup</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">ilookup</span><span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">]]]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">computer_edgelist</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>

<span class="n">flow_graph</span> <span class="o">=</span> <span class="n">ig</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">nv</span><span class="p">)</span>
<span class="n">flow_graph</span><span class="o">.</span><span class="n">add_edges</span><span class="p">(</span><span class="n">elist</span><span class="p">)</span>

<span class="n">flow_graph</span><span class="o">.</span><span class="n">is_connected</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre>False
</pre></div>


<p><img alt="alt text" src="https://github.com/box121209/LANL-analysis/raw/4102f12c070b2d8ef595585d9471ea514b202058/img/icmp_graph.png"></p>
<h3><code>Protocol</code></h3>
<h4>Protocol 6 (TCP) accounts for over 77.69% of events, Protocol 17 (UDP) accounts for 22.28% while Protocol 1 (ICMP) only accounts for .03%.</h4>
<div class="highlight"><pre><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;Protocol&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f6a2f7b7c50&gt;
</pre></div>


<p><img alt="png" src="Punch-netflow-project_files/Punch-netflow-project_51_1.png"></p>
<div class="highlight"><pre><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;Protocol&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;Protocol&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">17</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">/</span><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;Time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre>0.22279705287715498
</pre></div>


<h3><code>SrcPort</code> and <code>DstPort</code></h3>
<h4>Distribution across <code>SrcPort</code> seems nearly uniform.</h4>
<div class="highlight"><pre><span class="n">num_bins</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">train_df1</span><span class="p">[</span><span class="s">&#39;SrcPort&#39;</span><span class="p">],</span> <span class="n">num_bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="Punch-netflow-project_files/Punch-netflow-project_55_0.png"></p>
<h4><code>DstPort</code> is another story. The top 10 <code>DstPorts</code> account for over half of the events</h4>
<div class="highlight"><pre><span class="n">num_bins</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">train_df1</span><span class="p">[</span><span class="s">&#39;DstPort&#39;</span><span class="p">],</span> <span class="n">num_bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="Punch-netflow-project_files/Punch-netflow-project_57_0.png"></p>
<div class="highlight"><pre><span class="n">counted</span> <span class="o">=</span> <span class="n">train_df1</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&quot;DstPort&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;Time&quot;</span><span class="p">:</span><span class="s">&quot;DstPort_count&quot;</span><span class="p">})</span>
<span class="n">counted</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;DstPort_count&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DstPort_count</th>
      <th>Duration</th>
      <th>SrcPort</th>
      <th>SrcPackets</th>
      <th>DstPackets</th>
      <th>SrcBytes</th>
      <th>DstBytes</th>
      <th>SrcDevice_Comp</th>
      <th>DstDevice_Comp</th>
      <th>SrcDevice_IP</th>
      <th>...</th>
      <th>DstDevice_ActiveDirectory</th>
      <th>SrcDevice_EnterpriseAppServer</th>
      <th>DstDevice_EnterpriseAppServer</th>
      <th>SrcDevice_VPN</th>
      <th>DstDevice_VPN</th>
      <th>SrcDevice_VScanner</th>
      <th>DstDevice_VScanner</th>
      <th>Protocol_1</th>
      <th>Protocol_6</th>
      <th>Protocol_17</th>
    </tr>
    <tr>
      <th>DstPort</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>53</th>
      <td>750295</td>
      <td>750295</td>
      <td>750295</td>
      <td>750295</td>
      <td>750295</td>
      <td>750295</td>
      <td>750295</td>
      <td>750295</td>
      <td>750295</td>
      <td>750295</td>
      <td>...</td>
      <td>750295</td>
      <td>750295</td>
      <td>750295</td>
      <td>750295</td>
      <td>750295</td>
      <td>750295</td>
      <td>750295</td>
      <td>750295</td>
      <td>750295</td>
      <td>750295</td>
    </tr>
    <tr>
      <th>443</th>
      <td>700175</td>
      <td>700175</td>
      <td>700175</td>
      <td>700175</td>
      <td>700175</td>
      <td>700175</td>
      <td>700175</td>
      <td>700175</td>
      <td>700175</td>
      <td>700175</td>
      <td>...</td>
      <td>700175</td>
      <td>700175</td>
      <td>700175</td>
      <td>700175</td>
      <td>700175</td>
      <td>700175</td>
      <td>700175</td>
      <td>700175</td>
      <td>700175</td>
      <td>700175</td>
    </tr>
    <tr>
      <th>80</th>
      <td>607732</td>
      <td>607732</td>
      <td>607732</td>
      <td>607732</td>
      <td>607732</td>
      <td>607732</td>
      <td>607732</td>
      <td>607732</td>
      <td>607732</td>
      <td>607732</td>
      <td>...</td>
      <td>607732</td>
      <td>607732</td>
      <td>607732</td>
      <td>607732</td>
      <td>607732</td>
      <td>607732</td>
      <td>607732</td>
      <td>607732</td>
      <td>607732</td>
      <td>607732</td>
    </tr>
    <tr>
      <th>514</th>
      <td>264663</td>
      <td>264663</td>
      <td>264663</td>
      <td>264663</td>
      <td>264663</td>
      <td>264663</td>
      <td>264663</td>
      <td>264663</td>
      <td>264663</td>
      <td>264663</td>
      <td>...</td>
      <td>264663</td>
      <td>264663</td>
      <td>264663</td>
      <td>264663</td>
      <td>264663</td>
      <td>264663</td>
      <td>264663</td>
      <td>264663</td>
      <td>264663</td>
      <td>264663</td>
    </tr>
    <tr>
      <th>389</th>
      <td>213198</td>
      <td>213198</td>
      <td>213198</td>
      <td>213198</td>
      <td>213198</td>
      <td>213198</td>
      <td>213198</td>
      <td>213198</td>
      <td>213198</td>
      <td>213198</td>
      <td>...</td>
      <td>213198</td>
      <td>213198</td>
      <td>213198</td>
      <td>213198</td>
      <td>213198</td>
      <td>213198</td>
      <td>213198</td>
      <td>213198</td>
      <td>213198</td>
      <td>213198</td>
    </tr>
    <tr>
      <th>88</th>
      <td>162582</td>
      <td>162582</td>
      <td>162582</td>
      <td>162582</td>
      <td>162582</td>
      <td>162582</td>
      <td>162582</td>
      <td>162582</td>
      <td>162582</td>
      <td>162582</td>
      <td>...</td>
      <td>162582</td>
      <td>162582</td>
      <td>162582</td>
      <td>162582</td>
      <td>162582</td>
      <td>162582</td>
      <td>162582</td>
      <td>162582</td>
      <td>162582</td>
      <td>162582</td>
    </tr>
    <tr>
      <th>23118</th>
      <td>137832</td>
      <td>137832</td>
      <td>137832</td>
      <td>137832</td>
      <td>137832</td>
      <td>137832</td>
      <td>137832</td>
      <td>137832</td>
      <td>137832</td>
      <td>137832</td>
      <td>...</td>
      <td>137832</td>
      <td>137832</td>
      <td>137832</td>
      <td>137832</td>
      <td>137832</td>
      <td>137832</td>
      <td>137832</td>
      <td>137832</td>
      <td>137832</td>
      <td>137832</td>
    </tr>
    <tr>
      <th>427</th>
      <td>113420</td>
      <td>113420</td>
      <td>113420</td>
      <td>113420</td>
      <td>113420</td>
      <td>113420</td>
      <td>113420</td>
      <td>113420</td>
      <td>113420</td>
      <td>113420</td>
      <td>...</td>
      <td>113420</td>
      <td>113420</td>
      <td>113420</td>
      <td>113420</td>
      <td>113420</td>
      <td>113420</td>
      <td>113420</td>
      <td>113420</td>
      <td>113420</td>
      <td>113420</td>
    </tr>
    <tr>
      <th>95765</th>
      <td>99594</td>
      <td>99594</td>
      <td>99594</td>
      <td>99594</td>
      <td>99594</td>
      <td>99594</td>
      <td>99594</td>
      <td>99594</td>
      <td>99594</td>
      <td>99594</td>
      <td>...</td>
      <td>99594</td>
      <td>99594</td>
      <td>99594</td>
      <td>99594</td>
      <td>99594</td>
      <td>99594</td>
      <td>99594</td>
      <td>99594</td>
      <td>99594</td>
      <td>99594</td>
    </tr>
    <tr>
      <th>445</th>
      <td>99020</td>
      <td>99020</td>
      <td>99020</td>
      <td>99020</td>
      <td>99020</td>
      <td>99020</td>
      <td>99020</td>
      <td>99020</td>
      <td>99020</td>
      <td>99020</td>
      <td>...</td>
      <td>99020</td>
      <td>99020</td>
      <td>99020</td>
      <td>99020</td>
      <td>99020</td>
      <td>99020</td>
      <td>99020</td>
      <td>99020</td>
      <td>99020</td>
      <td>99020</td>
    </tr>
  </tbody>
</table>
<p>10 rows × 22 columns</p>
</div>

<div class="highlight"><pre><span class="nb">sum</span><span class="p">(</span><span class="n">counted</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;DstPort_count&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)[</span><span class="s">&#39;DstPort_count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
</pre></div>


<div class="highlight"><pre>3148511
</pre></div>


<h3><code>SrcPackets</code> and <code>DstPackets</code></h3>
<h4>91.47% of events send between 0-10 packets from the <code>SrcDevice</code>. The highest amount of packets sent is 87701075!</h4>
<div class="highlight"><pre><span class="n">counted</span> <span class="o">=</span> <span class="n">train_df1</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&quot;SrcPackets&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;Time&quot;</span><span class="p">:</span><span class="s">&quot;SrcPackets_count&quot;</span><span class="p">})</span>
<span class="n">counted</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;SrcPackets_count&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SrcPackets_count</th>
      <th>Duration</th>
      <th>SrcPort</th>
      <th>DstPort</th>
      <th>DstPackets</th>
      <th>SrcBytes</th>
      <th>DstBytes</th>
      <th>SrcDevice_Comp</th>
      <th>DstDevice_Comp</th>
      <th>SrcDevice_IP</th>
      <th>...</th>
      <th>DstDevice_ActiveDirectory</th>
      <th>SrcDevice_EnterpriseAppServer</th>
      <th>DstDevice_EnterpriseAppServer</th>
      <th>SrcDevice_VPN</th>
      <th>DstDevice_VPN</th>
      <th>SrcDevice_VScanner</th>
      <th>DstDevice_VScanner</th>
      <th>Protocol_1</th>
      <th>Protocol_6</th>
      <th>Protocol_17</th>
    </tr>
    <tr>
      <th>SrcPackets</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>...</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1181225</td>
      <td>1181225</td>
      <td>1181225</td>
      <td>1181225</td>
      <td>1181225</td>
      <td>1181225</td>
      <td>1181225</td>
      <td>1181225</td>
      <td>1181225</td>
      <td>1181225</td>
      <td>...</td>
      <td>1181225</td>
      <td>1181225</td>
      <td>1181225</td>
      <td>1181225</td>
      <td>1181225</td>
      <td>1181225</td>
      <td>1181225</td>
      <td>1181225</td>
      <td>1181225</td>
      <td>1181225</td>
    </tr>
    <tr>
      <th>5</th>
      <td>600726</td>
      <td>600726</td>
      <td>600726</td>
      <td>600726</td>
      <td>600726</td>
      <td>600726</td>
      <td>600726</td>
      <td>600726</td>
      <td>600726</td>
      <td>600726</td>
      <td>...</td>
      <td>600726</td>
      <td>600726</td>
      <td>600726</td>
      <td>600726</td>
      <td>600726</td>
      <td>600726</td>
      <td>600726</td>
      <td>600726</td>
      <td>600726</td>
      <td>600726</td>
    </tr>
    <tr>
      <th>4</th>
      <td>537638</td>
      <td>537638</td>
      <td>537638</td>
      <td>537638</td>
      <td>537638</td>
      <td>537638</td>
      <td>537638</td>
      <td>537638</td>
      <td>537638</td>
      <td>537638</td>
      <td>...</td>
      <td>537638</td>
      <td>537638</td>
      <td>537638</td>
      <td>537638</td>
      <td>537638</td>
      <td>537638</td>
      <td>537638</td>
      <td>537638</td>
      <td>537638</td>
      <td>537638</td>
    </tr>
    <tr>
      <th>3</th>
      <td>245588</td>
      <td>245588</td>
      <td>245588</td>
      <td>245588</td>
      <td>245588</td>
      <td>245588</td>
      <td>245588</td>
      <td>245588</td>
      <td>245588</td>
      <td>245588</td>
      <td>...</td>
      <td>245588</td>
      <td>245588</td>
      <td>245588</td>
      <td>245588</td>
      <td>245588</td>
      <td>245588</td>
      <td>245588</td>
      <td>245588</td>
      <td>245588</td>
      <td>245588</td>
    </tr>
    <tr>
      <th>2</th>
      <td>233467</td>
      <td>233467</td>
      <td>233467</td>
      <td>233467</td>
      <td>233467</td>
      <td>233467</td>
      <td>233467</td>
      <td>233467</td>
      <td>233467</td>
      <td>233467</td>
      <td>...</td>
      <td>233467</td>
      <td>233467</td>
      <td>233467</td>
      <td>233467</td>
      <td>233467</td>
      <td>233467</td>
      <td>233467</td>
      <td>233467</td>
      <td>233467</td>
      <td>233467</td>
    </tr>
    <tr>
      <th>6</th>
      <td>184014</td>
      <td>184014</td>
      <td>184014</td>
      <td>184014</td>
      <td>184014</td>
      <td>184014</td>
      <td>184014</td>
      <td>184014</td>
      <td>184014</td>
      <td>184014</td>
      <td>...</td>
      <td>184014</td>
      <td>184014</td>
      <td>184014</td>
      <td>184014</td>
      <td>184014</td>
      <td>184014</td>
      <td>184014</td>
      <td>184014</td>
      <td>184014</td>
      <td>184014</td>
    </tr>
    <tr>
      <th>10</th>
      <td>183998</td>
      <td>183998</td>
      <td>183998</td>
      <td>183998</td>
      <td>183998</td>
      <td>183998</td>
      <td>183998</td>
      <td>183998</td>
      <td>183998</td>
      <td>183998</td>
      <td>...</td>
      <td>183998</td>
      <td>183998</td>
      <td>183998</td>
      <td>183998</td>
      <td>183998</td>
      <td>183998</td>
      <td>183998</td>
      <td>183998</td>
      <td>183998</td>
      <td>183998</td>
    </tr>
    <tr>
      <th>11</th>
      <td>171049</td>
      <td>171049</td>
      <td>171049</td>
      <td>171049</td>
      <td>171049</td>
      <td>171049</td>
      <td>171049</td>
      <td>171049</td>
      <td>171049</td>
      <td>171049</td>
      <td>...</td>
      <td>171049</td>
      <td>171049</td>
      <td>171049</td>
      <td>171049</td>
      <td>171049</td>
      <td>171049</td>
      <td>171049</td>
      <td>171049</td>
      <td>171049</td>
      <td>171049</td>
    </tr>
    <tr>
      <th>7</th>
      <td>104048</td>
      <td>104048</td>
      <td>104048</td>
      <td>104048</td>
      <td>104048</td>
      <td>104048</td>
      <td>104048</td>
      <td>104048</td>
      <td>104048</td>
      <td>104048</td>
      <td>...</td>
      <td>104048</td>
      <td>104048</td>
      <td>104048</td>
      <td>104048</td>
      <td>104048</td>
      <td>104048</td>
      <td>104048</td>
      <td>104048</td>
      <td>104048</td>
      <td>104048</td>
    </tr>
  </tbody>
</table>
<p>10 rows × 22 columns</p>
</div>

<div class="highlight"><pre><span class="nb">sum</span><span class="p">(</span><span class="n">counted</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;SrcPackets_count&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)[</span><span class="s">&#39;SrcPackets_count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="mi">12</span><span class="p">])</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">counted</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;SrcPackets_count&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)[</span><span class="s">&#39;SrcPackets_count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>0.9146632947055655
</pre></div>


<div class="highlight"><pre><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">train_df1</span><span class="p">[</span><span class="s">&#39;SrcPackets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span>
</pre></div>


<div class="highlight"><pre>array([72759509, 74938675, 77148736, 79109660, 81076770, 82796324,
       84609078, 84760288, 86720597, 87701075])
</pre></div>


<h4>93.40% of events send between 0-10 packets from the <code>DstDevice</code>. The highest amount of packets sent is 77760718.</h4>
<div class="highlight"><pre><span class="n">counted</span> <span class="o">=</span> <span class="n">train_df1</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&quot;DstPackets&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;Time&quot;</span><span class="p">:</span><span class="s">&quot;DstPackets_count&quot;</span><span class="p">})</span>
<span class="n">counted</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;DstPackets_count&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DstPackets_count</th>
      <th>Duration</th>
      <th>SrcPort</th>
      <th>DstPort</th>
      <th>SrcPackets</th>
      <th>SrcBytes</th>
      <th>DstBytes</th>
      <th>SrcDevice_Comp</th>
      <th>DstDevice_Comp</th>
      <th>SrcDevice_IP</th>
      <th>...</th>
      <th>DstDevice_ActiveDirectory</th>
      <th>SrcDevice_EnterpriseAppServer</th>
      <th>DstDevice_EnterpriseAppServer</th>
      <th>SrcDevice_VPN</th>
      <th>DstDevice_VPN</th>
      <th>SrcDevice_VScanner</th>
      <th>DstDevice_VScanner</th>
      <th>Protocol_1</th>
      <th>Protocol_6</th>
      <th>Protocol_17</th>
    </tr>
    <tr>
      <th>DstPackets</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>...</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1746836</td>
      <td>1746836</td>
      <td>1746836</td>
      <td>1746836</td>
      <td>1746836</td>
      <td>1746836</td>
      <td>1746836</td>
      <td>1746836</td>
      <td>1746836</td>
      <td>1746836</td>
      <td>...</td>
      <td>1746836</td>
      <td>1746836</td>
      <td>1746836</td>
      <td>1746836</td>
      <td>1746836</td>
      <td>1746836</td>
      <td>1746836</td>
      <td>1746836</td>
      <td>1746836</td>
      <td>1746836</td>
    </tr>
    <tr>
      <th>3</th>
      <td>596994</td>
      <td>596994</td>
      <td>596994</td>
      <td>596994</td>
      <td>596994</td>
      <td>596994</td>
      <td>596994</td>
      <td>596994</td>
      <td>596994</td>
      <td>596994</td>
      <td>...</td>
      <td>596994</td>
      <td>596994</td>
      <td>596994</td>
      <td>596994</td>
      <td>596994</td>
      <td>596994</td>
      <td>596994</td>
      <td>596994</td>
      <td>596994</td>
      <td>596994</td>
    </tr>
    <tr>
      <th>5</th>
      <td>283068</td>
      <td>283068</td>
      <td>283068</td>
      <td>283068</td>
      <td>283068</td>
      <td>283068</td>
      <td>283068</td>
      <td>283068</td>
      <td>283068</td>
      <td>283068</td>
      <td>...</td>
      <td>283068</td>
      <td>283068</td>
      <td>283068</td>
      <td>283068</td>
      <td>283068</td>
      <td>283068</td>
      <td>283068</td>
      <td>283068</td>
      <td>283068</td>
      <td>283068</td>
    </tr>
    <tr>
      <th>2</th>
      <td>218062</td>
      <td>218062</td>
      <td>218062</td>
      <td>218062</td>
      <td>218062</td>
      <td>218062</td>
      <td>218062</td>
      <td>218062</td>
      <td>218062</td>
      <td>218062</td>
      <td>...</td>
      <td>218062</td>
      <td>218062</td>
      <td>218062</td>
      <td>218062</td>
      <td>218062</td>
      <td>218062</td>
      <td>218062</td>
      <td>218062</td>
      <td>218062</td>
      <td>218062</td>
    </tr>
    <tr>
      <th>4</th>
      <td>196227</td>
      <td>196227</td>
      <td>196227</td>
      <td>196227</td>
      <td>196227</td>
      <td>196227</td>
      <td>196227</td>
      <td>196227</td>
      <td>196227</td>
      <td>196227</td>
      <td>...</td>
      <td>196227</td>
      <td>196227</td>
      <td>196227</td>
      <td>196227</td>
      <td>196227</td>
      <td>196227</td>
      <td>196227</td>
      <td>196227</td>
      <td>196227</td>
      <td>196227</td>
    </tr>
    <tr>
      <th>7</th>
      <td>189765</td>
      <td>189765</td>
      <td>189765</td>
      <td>189765</td>
      <td>189765</td>
      <td>189765</td>
      <td>189765</td>
      <td>189765</td>
      <td>189765</td>
      <td>189765</td>
      <td>...</td>
      <td>189765</td>
      <td>189765</td>
      <td>189765</td>
      <td>189765</td>
      <td>189765</td>
      <td>189765</td>
      <td>189765</td>
      <td>189765</td>
      <td>189765</td>
      <td>189765</td>
    </tr>
    <tr>
      <th>6</th>
      <td>120250</td>
      <td>120250</td>
      <td>120250</td>
      <td>120250</td>
      <td>120250</td>
      <td>120250</td>
      <td>120250</td>
      <td>120250</td>
      <td>120250</td>
      <td>120250</td>
      <td>...</td>
      <td>120250</td>
      <td>120250</td>
      <td>120250</td>
      <td>120250</td>
      <td>120250</td>
      <td>120250</td>
      <td>120250</td>
      <td>120250</td>
      <td>120250</td>
      <td>120250</td>
    </tr>
    <tr>
      <th>9</th>
      <td>68150</td>
      <td>68150</td>
      <td>68150</td>
      <td>68150</td>
      <td>68150</td>
      <td>68150</td>
      <td>68150</td>
      <td>68150</td>
      <td>68150</td>
      <td>68150</td>
      <td>...</td>
      <td>68150</td>
      <td>68150</td>
      <td>68150</td>
      <td>68150</td>
      <td>68150</td>
      <td>68150</td>
      <td>68150</td>
      <td>68150</td>
      <td>68150</td>
      <td>68150</td>
    </tr>
    <tr>
      <th>11</th>
      <td>63692</td>
      <td>63692</td>
      <td>63692</td>
      <td>63692</td>
      <td>63692</td>
      <td>63692</td>
      <td>63692</td>
      <td>63692</td>
      <td>63692</td>
      <td>63692</td>
      <td>...</td>
      <td>63692</td>
      <td>63692</td>
      <td>63692</td>
      <td>63692</td>
      <td>63692</td>
      <td>63692</td>
      <td>63692</td>
      <td>63692</td>
      <td>63692</td>
      <td>63692</td>
    </tr>
  </tbody>
</table>
<p>10 rows × 22 columns</p>
</div>

<div class="highlight"><pre><span class="nb">sum</span><span class="p">(</span><span class="n">counted</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;DstPackets_count&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)[</span><span class="s">&#39;DstPackets_count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="mi">12</span><span class="p">])</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">counted</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;DstPackets_count&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)[</span><span class="s">&#39;DstPackets_count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>0.9340995957612535
</pre></div>


<div class="highlight"><pre><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">train_df1</span><span class="p">[</span><span class="s">&#39;DstPackets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span>
</pre></div>


<div class="highlight"><pre>array([64687095, 66650395, 68478386, 68610780, 70356457, 71882842,
       73626605, 75365457, 77107098, 77760718])
</pre></div>


<h3><code>SrcBytes</code> and <code>DstBytes</code></h3>
<h4>Initial Look</h4>
<div class="highlight"><pre><span class="n">counted</span> <span class="o">=</span> <span class="n">train_df1</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&quot;SrcBytes&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;Time&quot;</span><span class="p">:</span><span class="s">&quot;SrcBytes_count&quot;</span><span class="p">})</span>
<span class="n">counted</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;SrcBytes_count&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>SrcBytes_count</th>
      <th>Duration</th>
      <th>SrcPort</th>
      <th>DstPort</th>
      <th>SrcPackets</th>
      <th>DstPackets</th>
      <th>DstBytes</th>
      <th>SrcDevice_Comp</th>
      <th>DstDevice_Comp</th>
      <th>SrcDevice_IP</th>
      <th>...</th>
      <th>DstDevice_ActiveDirectory</th>
      <th>SrcDevice_EnterpriseAppServer</th>
      <th>DstDevice_EnterpriseAppServer</th>
      <th>SrcDevice_VPN</th>
      <th>DstDevice_VPN</th>
      <th>SrcDevice_VScanner</th>
      <th>DstDevice_VScanner</th>
      <th>Protocol_1</th>
      <th>Protocol_6</th>
      <th>Protocol_17</th>
    </tr>
    <tr>
      <th>SrcBytes</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>...</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
      <td>1951332</td>
    </tr>
    <tr>
      <th>277</th>
      <td>268365</td>
      <td>268365</td>
      <td>268365</td>
      <td>268365</td>
      <td>268365</td>
      <td>268365</td>
      <td>268365</td>
      <td>268365</td>
      <td>268365</td>
      <td>268365</td>
      <td>...</td>
      <td>268365</td>
      <td>268365</td>
      <td>268365</td>
      <td>268365</td>
      <td>268365</td>
      <td>268365</td>
      <td>268365</td>
      <td>268365</td>
      <td>268365</td>
      <td>268365</td>
    </tr>
    <tr>
      <th>216</th>
      <td>266771</td>
      <td>266771</td>
      <td>266771</td>
      <td>266771</td>
      <td>266771</td>
      <td>266771</td>
      <td>266771</td>
      <td>266771</td>
      <td>266771</td>
      <td>266771</td>
      <td>...</td>
      <td>266771</td>
      <td>266771</td>
      <td>266771</td>
      <td>266771</td>
      <td>266771</td>
      <td>266771</td>
      <td>266771</td>
      <td>266771</td>
      <td>266771</td>
      <td>266771</td>
    </tr>
    <tr>
      <th>60</th>
      <td>247876</td>
      <td>247876</td>
      <td>247876</td>
      <td>247876</td>
      <td>247876</td>
      <td>247876</td>
      <td>247876</td>
      <td>247876</td>
      <td>247876</td>
      <td>247876</td>
      <td>...</td>
      <td>247876</td>
      <td>247876</td>
      <td>247876</td>
      <td>247876</td>
      <td>247876</td>
      <td>247876</td>
      <td>247876</td>
      <td>247876</td>
      <td>247876</td>
      <td>247876</td>
    </tr>
    <tr>
      <th>225</th>
      <td>112601</td>
      <td>112601</td>
      <td>112601</td>
      <td>112601</td>
      <td>112601</td>
      <td>112601</td>
      <td>112601</td>
      <td>112601</td>
      <td>112601</td>
      <td>112601</td>
      <td>...</td>
      <td>112601</td>
      <td>112601</td>
      <td>112601</td>
      <td>112601</td>
      <td>112601</td>
      <td>112601</td>
      <td>112601</td>
      <td>112601</td>
      <td>112601</td>
      <td>112601</td>
    </tr>
    <tr>
      <th>164</th>
      <td>99908</td>
      <td>99908</td>
      <td>99908</td>
      <td>99908</td>
      <td>99908</td>
      <td>99908</td>
      <td>99908</td>
      <td>99908</td>
      <td>99908</td>
      <td>99908</td>
      <td>...</td>
      <td>99908</td>
      <td>99908</td>
      <td>99908</td>
      <td>99908</td>
      <td>99908</td>
      <td>99908</td>
      <td>99908</td>
      <td>99908</td>
      <td>99908</td>
      <td>99908</td>
    </tr>
    <tr>
      <th>399</th>
      <td>77662</td>
      <td>77662</td>
      <td>77662</td>
      <td>77662</td>
      <td>77662</td>
      <td>77662</td>
      <td>77662</td>
      <td>77662</td>
      <td>77662</td>
      <td>77662</td>
      <td>...</td>
      <td>77662</td>
      <td>77662</td>
      <td>77662</td>
      <td>77662</td>
      <td>77662</td>
      <td>77662</td>
      <td>77662</td>
      <td>77662</td>
      <td>77662</td>
      <td>77662</td>
    </tr>
    <tr>
      <th>152</th>
      <td>74380</td>
      <td>74380</td>
      <td>74380</td>
      <td>74380</td>
      <td>74380</td>
      <td>74380</td>
      <td>74380</td>
      <td>74380</td>
      <td>74380</td>
      <td>74380</td>
      <td>...</td>
      <td>74380</td>
      <td>74380</td>
      <td>74380</td>
      <td>74380</td>
      <td>74380</td>
      <td>74380</td>
      <td>74380</td>
      <td>74380</td>
      <td>74380</td>
      <td>74380</td>
    </tr>
    <tr>
      <th>46</th>
      <td>71063</td>
      <td>71063</td>
      <td>71063</td>
      <td>71063</td>
      <td>71063</td>
      <td>71063</td>
      <td>71063</td>
      <td>71063</td>
      <td>71063</td>
      <td>71063</td>
      <td>...</td>
      <td>71063</td>
      <td>71063</td>
      <td>71063</td>
      <td>71063</td>
      <td>71063</td>
      <td>71063</td>
      <td>71063</td>
      <td>71063</td>
      <td>71063</td>
      <td>71063</td>
    </tr>
    <tr>
      <th>64</th>
      <td>62962</td>
      <td>62962</td>
      <td>62962</td>
      <td>62962</td>
      <td>62962</td>
      <td>62962</td>
      <td>62962</td>
      <td>62962</td>
      <td>62962</td>
      <td>62962</td>
      <td>...</td>
      <td>62962</td>
      <td>62962</td>
      <td>62962</td>
      <td>62962</td>
      <td>62962</td>
      <td>62962</td>
      <td>62962</td>
      <td>62962</td>
      <td>62962</td>
      <td>62962</td>
    </tr>
  </tbody>
</table>
<p>10 rows × 22 columns</p>
</div>

<div class="highlight"><pre><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;SrcBytes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span>
</pre></div>


<div class="highlight"><pre>array([12122909246, 12459931268, 12832178150, 13209994822, 13545567320,
       13882204590, 14176496098, 14513284176, 14848224144, 15015712600])
</pre></div>


<div class="highlight"><pre><span class="n">counted</span> <span class="o">=</span> <span class="n">train_df1</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&quot;DstBytes&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;Time&quot;</span><span class="p">:</span><span class="s">&quot;DstBytes_count&quot;</span><span class="p">})</span>
<span class="n">counted</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;DstBytes_count&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>DstBytes_count</th>
      <th>Duration</th>
      <th>SrcPort</th>
      <th>DstPort</th>
      <th>SrcPackets</th>
      <th>DstPackets</th>
      <th>SrcBytes</th>
      <th>SrcDevice_Comp</th>
      <th>DstDevice_Comp</th>
      <th>SrcDevice_IP</th>
      <th>...</th>
      <th>DstDevice_ActiveDirectory</th>
      <th>SrcDevice_EnterpriseAppServer</th>
      <th>DstDevice_EnterpriseAppServer</th>
      <th>SrcDevice_VPN</th>
      <th>DstDevice_VPN</th>
      <th>SrcDevice_VScanner</th>
      <th>DstDevice_VScanner</th>
      <th>Protocol_1</th>
      <th>Protocol_6</th>
      <th>Protocol_17</th>
    </tr>
    <tr>
      <th>DstBytes</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>...</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
      <td>2098503</td>
    </tr>
    <tr>
      <th>46</th>
      <td>1500887</td>
      <td>1500887</td>
      <td>1500887</td>
      <td>1500887</td>
      <td>1500887</td>
      <td>1500887</td>
      <td>1500887</td>
      <td>1500887</td>
      <td>1500887</td>
      <td>1500887</td>
      <td>...</td>
      <td>1500887</td>
      <td>1500887</td>
      <td>1500887</td>
      <td>1500887</td>
      <td>1500887</td>
      <td>1500887</td>
      <td>1500887</td>
      <td>1500887</td>
      <td>1500887</td>
      <td>1500887</td>
    </tr>
    <tr>
      <th>164</th>
      <td>224058</td>
      <td>224058</td>
      <td>224058</td>
      <td>224058</td>
      <td>224058</td>
      <td>224058</td>
      <td>224058</td>
      <td>224058</td>
      <td>224058</td>
      <td>224058</td>
      <td>...</td>
      <td>224058</td>
      <td>224058</td>
      <td>224058</td>
      <td>224058</td>
      <td>224058</td>
      <td>224058</td>
      <td>224058</td>
      <td>224058</td>
      <td>224058</td>
      <td>224058</td>
    </tr>
    <tr>
      <th>3911</th>
      <td>71773</td>
      <td>71773</td>
      <td>71773</td>
      <td>71773</td>
      <td>71773</td>
      <td>71773</td>
      <td>71773</td>
      <td>71773</td>
      <td>71773</td>
      <td>71773</td>
      <td>...</td>
      <td>71773</td>
      <td>71773</td>
      <td>71773</td>
      <td>71773</td>
      <td>71773</td>
      <td>71773</td>
      <td>71773</td>
      <td>71773</td>
      <td>71773</td>
      <td>71773</td>
    </tr>
    <tr>
      <th>479</th>
      <td>57954</td>
      <td>57954</td>
      <td>57954</td>
      <td>57954</td>
      <td>57954</td>
      <td>57954</td>
      <td>57954</td>
      <td>57954</td>
      <td>57954</td>
      <td>57954</td>
      <td>...</td>
      <td>57954</td>
      <td>57954</td>
      <td>57954</td>
      <td>57954</td>
      <td>57954</td>
      <td>57954</td>
      <td>57954</td>
      <td>57954</td>
      <td>57954</td>
      <td>57954</td>
    </tr>
    <tr>
      <th>112</th>
      <td>55094</td>
      <td>55094</td>
      <td>55094</td>
      <td>55094</td>
      <td>55094</td>
      <td>55094</td>
      <td>55094</td>
      <td>55094</td>
      <td>55094</td>
      <td>55094</td>
      <td>...</td>
      <td>55094</td>
      <td>55094</td>
      <td>55094</td>
      <td>55094</td>
      <td>55094</td>
      <td>55094</td>
      <td>55094</td>
      <td>55094</td>
      <td>55094</td>
      <td>55094</td>
    </tr>
    <tr>
      <th>106</th>
      <td>53733</td>
      <td>53733</td>
      <td>53733</td>
      <td>53733</td>
      <td>53733</td>
      <td>53733</td>
      <td>53733</td>
      <td>53733</td>
      <td>53733</td>
      <td>53733</td>
      <td>...</td>
      <td>53733</td>
      <td>53733</td>
      <td>53733</td>
      <td>53733</td>
      <td>53733</td>
      <td>53733</td>
      <td>53733</td>
      <td>53733</td>
      <td>53733</td>
      <td>53733</td>
    </tr>
    <tr>
      <th>177</th>
      <td>39591</td>
      <td>39591</td>
      <td>39591</td>
      <td>39591</td>
      <td>39591</td>
      <td>39591</td>
      <td>39591</td>
      <td>39591</td>
      <td>39591</td>
      <td>39591</td>
      <td>...</td>
      <td>39591</td>
      <td>39591</td>
      <td>39591</td>
      <td>39591</td>
      <td>39591</td>
      <td>39591</td>
      <td>39591</td>
      <td>39591</td>
      <td>39591</td>
      <td>39591</td>
    </tr>
    <tr>
      <th>1503</th>
      <td>38017</td>
      <td>38017</td>
      <td>38017</td>
      <td>38017</td>
      <td>38017</td>
      <td>38017</td>
      <td>38017</td>
      <td>38017</td>
      <td>38017</td>
      <td>38017</td>
      <td>...</td>
      <td>38017</td>
      <td>38017</td>
      <td>38017</td>
      <td>38017</td>
      <td>38017</td>
      <td>38017</td>
      <td>38017</td>
      <td>38017</td>
      <td>38017</td>
      <td>38017</td>
    </tr>
    <tr>
      <th>853</th>
      <td>32385</td>
      <td>32385</td>
      <td>32385</td>
      <td>32385</td>
      <td>32385</td>
      <td>32385</td>
      <td>32385</td>
      <td>32385</td>
      <td>32385</td>
      <td>32385</td>
      <td>...</td>
      <td>32385</td>
      <td>32385</td>
      <td>32385</td>
      <td>32385</td>
      <td>32385</td>
      <td>32385</td>
      <td>32385</td>
      <td>32385</td>
      <td>32385</td>
      <td>32385</td>
    </tr>
  </tbody>
</table>
<p>10 rows × 22 columns</p>
</div>

<div class="highlight"><pre><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;DstBytes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)[</span><span class="o">-</span><span class="mi">10</span><span class="p">:]</span>
</pre></div>


<div class="highlight"><pre>array([11146902232, 11457059168, 11805619364, 12153021664, 12461839686,
       12732086028, 13040875936, 13348384456, 13657486438, 13773586368])
</pre></div>


<h4>Question: As someone new to the field, I'm uncertain why the number of bytes for events jumps from 0 to 42.</h4>
<div class="highlight"><pre><span class="n">unique_df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;DstBytes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">unique_df</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre>array([ 0, 42, 44, 46, 48, 49, 52, 55, 56, 58])
</pre></div>


<div class="highlight"><pre><span class="n">unique_df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;SrcBytes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">unique_df</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre>array([ 0, 42, 44, 46, 47, 48, 49, 50, 51, 52])
</pre></div>


<h4>Distributions of <code>Packets</code> and <code>Bytes</code> seem to follow a power law which appears to be normal.</h4>
<div class="highlight"><pre><span class="n">num_bins</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;SrcPackets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">+</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">num_bins</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;SrcPackets&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;DstPackets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">+</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">num_bins</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;DstPackets&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;SrcBytes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">+</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">num_bins</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;green&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;SrcBytes&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;DstBytes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">+</span><span class="mf">0.5</span><span class="p">),</span> <span class="n">num_bins</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;SrcBytes&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&quot;Size&quot;</span><span class="p">)</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&quot;Count&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span> <span class="n">loc</span><span class="o">=</span><span class="s">&#39;upper right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">1e0</span><span class="p">,</span><span class="mf">1e2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="Punch-netflow-project_files/Punch-netflow-project_79_0.png"></p>
<h4>Looking at a 2d heatmap of <code>Packets</code> vs <code>Bytes</code> shows a clean linear correlation, with all flows exhibiting an average packet size (i.e. bytes/packets) between 32 and 1024 bytes.</h4>
<div class="highlight"><pre><span class="n">tdf</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">tdf</span><span class="p">[</span><span class="s">&#39;SrcPackets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">tdf</span><span class="p">[</span><span class="s">&#39;SrcPackets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">tdf</span><span class="p">[</span><span class="s">&#39;SrcBytes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">tdf</span><span class="p">[</span><span class="s">&#39;SrcBytes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;SrcPackets&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">&quot;SrcBytes&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">tdf</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">&quot;hex&quot;</span><span class="p">,</span><span class="n">Norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">())</span>
</pre></div>


<div class="highlight"><pre>&lt;seaborn.axisgrid.JointGrid at 0x7f4f5d15d278&gt;
</pre></div>


<p><img alt="png" src="Punch-netflow-project_files/Punch-netflow-project_81_1.png"></p>
<div class="highlight"><pre><span class="n">tdf</span><span class="p">[</span><span class="s">&#39;DstPackets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">tdf</span><span class="p">[</span><span class="s">&#39;DstPackets&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">tdf</span><span class="p">[</span><span class="s">&#39;DstBytes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">tdf</span><span class="p">[</span><span class="s">&#39;DstBytes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;DstPackets&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">&quot;DstBytes&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">tdf</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s">&quot;hex&quot;</span><span class="p">,</span><span class="n">Norm</span> <span class="o">=</span> <span class="n">LogNorm</span><span class="p">())</span>
</pre></div>


<div class="highlight"><pre>&lt;seaborn.axisgrid.JointGrid at 0x7f4f5f4c51d0&gt;
</pre></div>


<p><img alt="png" src="Punch-netflow-project_files/Punch-netflow-project_82_1.png"></p>
<h3><code>Time</code> and <code>Duration</code></h3>
<h4>80% of the events last less than 1 second. The longest event took 978035 seconds or roughly 271 hours.</h4>
<div class="highlight"><pre><span class="n">counted</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">&quot;Duration&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;Time&quot;</span><span class="p">:</span><span class="s">&quot;Duration_count&quot;</span><span class="p">})</span>
<span class="n">counted</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;Duration_count&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Duration_count</th>
      <th>SrcDevice</th>
      <th>DstDevice</th>
      <th>Protocol</th>
      <th>SrcPort</th>
      <th>DstPort</th>
      <th>SrcPackets</th>
      <th>DstPackets</th>
      <th>SrcBytes</th>
      <th>DstBytes</th>
    </tr>
    <tr>
      <th>Duration</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2754172</td>
      <td>2754172</td>
      <td>2754172</td>
      <td>2754172</td>
      <td>2754172</td>
      <td>2754172</td>
      <td>2754172</td>
      <td>2754172</td>
      <td>2754172</td>
      <td>2754172</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2133800</td>
      <td>2133800</td>
      <td>2133800</td>
      <td>2133800</td>
      <td>2133800</td>
      <td>2133800</td>
      <td>2133800</td>
      <td>2133800</td>
      <td>2133800</td>
      <td>2133800</td>
    </tr>
    <tr>
      <th>2</th>
      <td>80962</td>
      <td>80962</td>
      <td>80962</td>
      <td>80962</td>
      <td>80962</td>
      <td>80962</td>
      <td>80962</td>
      <td>80962</td>
      <td>80962</td>
      <td>80962</td>
    </tr>
    <tr>
      <th>9</th>
      <td>68782</td>
      <td>68782</td>
      <td>68782</td>
      <td>68782</td>
      <td>68782</td>
      <td>68782</td>
      <td>68782</td>
      <td>68782</td>
      <td>68782</td>
      <td>68782</td>
    </tr>
    <tr>
      <th>5</th>
      <td>59152</td>
      <td>59152</td>
      <td>59152</td>
      <td>59152</td>
      <td>59152</td>
      <td>59152</td>
      <td>59152</td>
      <td>59152</td>
      <td>59152</td>
      <td>59152</td>
    </tr>
    <tr>
      <th>3</th>
      <td>36107</td>
      <td>36107</td>
      <td>36107</td>
      <td>36107</td>
      <td>36107</td>
      <td>36107</td>
      <td>36107</td>
      <td>36107</td>
      <td>36107</td>
      <td>36107</td>
    </tr>
    <tr>
      <th>12</th>
      <td>34511</td>
      <td>34511</td>
      <td>34511</td>
      <td>34511</td>
      <td>34511</td>
      <td>34511</td>
      <td>34511</td>
      <td>34511</td>
      <td>34511</td>
      <td>34511</td>
    </tr>
    <tr>
      <th>6</th>
      <td>28342</td>
      <td>28342</td>
      <td>28342</td>
      <td>28342</td>
      <td>28342</td>
      <td>28342</td>
      <td>28342</td>
      <td>28342</td>
      <td>28342</td>
      <td>28342</td>
    </tr>
    <tr>
      <th>4</th>
      <td>28297</td>
      <td>28297</td>
      <td>28297</td>
      <td>28297</td>
      <td>28297</td>
      <td>28297</td>
      <td>28297</td>
      <td>28297</td>
      <td>28297</td>
      <td>28297</td>
    </tr>
    <tr>
      <th>15</th>
      <td>25519</td>
      <td>25519</td>
      <td>25519</td>
      <td>25519</td>
      <td>25519</td>
      <td>25519</td>
      <td>25519</td>
      <td>25519</td>
      <td>25519</td>
      <td>25519</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span class="nb">sum</span><span class="p">(</span><span class="n">counted</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;Duration_count&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)[</span><span class="s">&#39;Duration_count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="nb">sum</span><span class="p">(</span><span class="n">counted</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;Duration_count&#39;</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)[</span><span class="s">&#39;Duration_count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>0.8010328269655939
</pre></div>


<div class="highlight"><pre><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">train_df1</span><span class="p">[</span><span class="s">&#39;Duration&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span><span class="o">/</span><span class="mi">60</span><span class="o">/</span><span class="mi">60</span>
</pre></div>


<div class="highlight"><pre>array([271.67638889])
</pre></div>


<div class="highlight"><pre><span class="n">num_bins</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;Duration&#39;</span><span class="p">],</span> <span class="n">num_bins</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">log</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="Punch-netflow-project_files/Punch-netflow-project_88_0.png"></p>
<div class="highlight"><pre><span class="n">num_bins</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">train_df1</span><span class="p">[</span><span class="s">&#39;Time&#39;</span><span class="p">],</span> <span class="n">num_bins</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="Punch-netflow-project_files/Punch-netflow-project_89_0.png"></p>
<div class="highlight"><pre><span class="n">train_df</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre>Index([&#39;Time&#39;, &#39;Duration&#39;, &#39;SrcDevice&#39;, &#39;DstDevice&#39;, &#39;Protocol&#39;, &#39;SrcPort&#39;,
       &#39;DstPort&#39;, &#39;SrcPackets&#39;, &#39;DstPackets&#39;, &#39;SrcBytes&#39;, &#39;DstBytes&#39;],
      dtype=&#39;object&#39;)
</pre></div>


<div class="highlight"><pre><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">stem</span><span class="p">(</span><span class="n">duration_hist</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">duration_hist</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">markerfmt</span><span class="o">=</span><span class="s">&#39;b.&#39;</span><span class="p">)</span>
</pre></div>


<h3>Normalize data</h3>
<h4>In order for our autoencoder to train better, it will be useful to normalize the data. I initially skipped this step and was getting astronomically high losses!</h4>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">RobustScaler</span>
</pre></div>


<div class="highlight"><pre><span class="n">colnames_tsa</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Time&#39;</span><span class="p">,</span> <span class="s">&#39;Duration&#39;</span><span class="p">,</span> <span class="s">&#39;SrcDevice&#39;</span><span class="p">,</span> <span class="s">&#39;DstDevice&#39;</span><span class="p">,</span> <span class="s">&#39;Protocol&#39;</span><span class="p">,</span> <span class="s">&#39;SrcPort&#39;</span><span class="p">,</span> <span class="s">&#39;DstPort&#39;</span><span class="p">,</span> <span class="s">&#39;SrcPackets&#39;</span><span class="p">,</span> 
        <span class="s">&#39;DstPackets&#39;</span><span class="p">,</span> <span class="s">&#39;SrcBytes&#39;</span><span class="p">,</span> <span class="s">&#39;DstBytes&#39;</span><span class="p">,</span> <span class="s">&#39;SrcPackets_mean1s&#39;</span><span class="p">,</span><span class="s">&#39;SrcPackets_std1s&#39;</span><span class="p">,</span><span class="s">&#39;SrcPackets_mean10s&#39;</span><span class="p">,</span>
        <span class="s">&#39;SrcPackets_std10s&#39;</span><span class="p">,</span><span class="s">&#39;SrcPackets_mean60s&#39;</span><span class="p">,</span><span class="s">&#39;SrcPackets_std60s&#39;</span><span class="p">,</span> <span class="s">&#39;DstPackets_mean1s&#39;</span><span class="p">,</span><span class="s">&#39;DstPackets_std1s&#39;</span><span class="p">,</span><span class="s">&#39;DstPackets_mean10s&#39;</span><span class="p">,</span>
        <span class="s">&#39;DstPackets_std10s&#39;</span><span class="p">,</span><span class="s">&#39;DstPackets_mean60s&#39;</span><span class="p">,</span><span class="s">&#39;DstPackets_std60s&#39;</span><span class="p">,</span> <span class="s">&#39;SrcBytes_mean1s&#39;</span><span class="p">,</span><span class="s">&#39;SrcBytes_std1s&#39;</span><span class="p">,</span><span class="s">&#39;SrcBytes_mean10s&#39;</span><span class="p">,</span>
        <span class="s">&#39;SrcBytes_std10s&#39;</span><span class="p">,</span><span class="s">&#39;SrcBytes_mean60s&#39;</span><span class="p">,</span><span class="s">&#39;SrcBytes_std60s&#39;</span><span class="p">,</span> <span class="s">&#39;DstBytes_mean1s&#39;</span><span class="p">,</span><span class="s">&#39;DstBytes_std1s&#39;</span><span class="p">,</span><span class="s">&#39;DstBytes_mean10s&#39;</span><span class="p">,</span>
        <span class="s">&#39;DstBytes_std10s&#39;</span><span class="p">,</span><span class="s">&#39;DstBytes_mean60s&#39;</span><span class="p">,</span><span class="s">&#39;DstBytes_std60s&#39;</span><span class="p">,]</span>

<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">scaled_df</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span>
<span class="n">scaled_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaled_df</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">colnames</span><span class="p">)</span>
<span class="n">scaler1</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
<span class="n">scaled_df1</span> <span class="o">=</span> <span class="n">scaler1</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">train_df2</span><span class="p">)</span>
<span class="n">scaled_df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaled_df1</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">colnames_tsa</span><span class="p">)</span>
<span class="n">scaler2</span> <span class="o">=</span> <span class="n">RobustScaler</span><span class="p">()</span>
<span class="n">scaled_df2</span> <span class="o">=</span> <span class="n">scaler2</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span>
<span class="n">scaled_df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaled_df2</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">colnames</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Before Scaling&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;SrcDevice&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;DstDevice&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;SrcPort&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;DstPort&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;After Standard Scaler&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">scaled_df</span><span class="p">[</span><span class="s">&#39;SrcDevice&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">scaled_df</span><span class="p">[</span><span class="s">&#39;DstDevice&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">scaled_df</span><span class="p">[</span><span class="s">&#39;SrcPort&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">scaled_df</span><span class="p">[</span><span class="s">&#39;DstPort&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;After Min-Max Scaler&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">scaled_df1</span><span class="p">[</span><span class="s">&#39;SrcDevice&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">scaled_df1</span><span class="p">[</span><span class="s">&#39;DstDevice&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">scaled_df1</span><span class="p">[</span><span class="s">&#39;SrcPort&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">scaled_df1</span><span class="p">[</span><span class="s">&#39;DstPort&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;After Robust Scaler&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">scaled_df2</span><span class="p">[</span><span class="s">&#39;SrcDevice&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax4</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">scaled_df2</span><span class="p">[</span><span class="s">&#39;DstDevice&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax4</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">scaled_df2</span><span class="p">[</span><span class="s">&#39;SrcPort&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax4</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">scaled_df2</span><span class="p">[</span><span class="s">&#39;DstPort&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span class="o">/</span><span class="nt">home</span><span class="o">/</span><span class="nt">paperspace</span><span class="o">/</span><span class="nt">anaconda3</span><span class="o">/</span><span class="nt">envs</span><span class="o">/</span><span class="nt">fastaiv1</span><span class="o">/</span><span class="nt">lib</span><span class="o">/</span><span class="nt">python3</span><span class="nc">.7</span><span class="o">/</span><span class="nt">site-packages</span><span class="o">/</span><span class="nt">sklearn</span><span class="o">/</span><span class="nt">preprocessing</span><span class="o">/</span><span class="nt">data</span><span class="nc">.py</span><span class="nd">:625</span><span class="o">:</span> <span class="nt">DataConversionWarning</span><span class="o">:</span> <span class="nt">Data</span> <span class="nt">with</span> <span class="nt">input</span> <span class="nt">dtype</span> <span class="nt">int8</span><span class="o">,</span> <span class="nt">int16</span><span class="o">,</span> <span class="nt">int32</span><span class="o">,</span> <span class="nt">int64</span> <span class="nt">were</span> <span class="nt">all</span> <span class="nt">converted</span> <span class="nt">to</span> <span class="nt">float64</span> <span class="nt">by</span> <span class="nt">StandardScaler</span><span class="o">.</span>
  <span class="nt">return</span> <span class="nt">self</span><span class="nc">.partial_fit</span><span class="o">(</span><span class="nt">X</span><span class="o">,</span> <span class="nt">y</span><span class="o">)</span>
<span class="o">/</span><span class="nt">home</span><span class="o">/</span><span class="nt">paperspace</span><span class="o">/</span><span class="nt">anaconda3</span><span class="o">/</span><span class="nt">envs</span><span class="o">/</span><span class="nt">fastaiv1</span><span class="o">/</span><span class="nt">lib</span><span class="o">/</span><span class="nt">python3</span><span class="nc">.7</span><span class="o">/</span><span class="nt">site-packages</span><span class="o">/</span><span class="nt">sklearn</span><span class="o">/</span><span class="nt">base</span><span class="nc">.py</span><span class="nd">:462</span><span class="o">:</span> <span class="nt">DataConversionWarning</span><span class="o">:</span> <span class="nt">Data</span> <span class="nt">with</span> <span class="nt">input</span> <span class="nt">dtype</span> <span class="nt">int8</span><span class="o">,</span> <span class="nt">int16</span><span class="o">,</span> <span class="nt">int32</span><span class="o">,</span> <span class="nt">int64</span> <span class="nt">were</span> <span class="nt">all</span> <span class="nt">converted</span> <span class="nt">to</span> <span class="nt">float64</span> <span class="nt">by</span> <span class="nt">StandardScaler</span><span class="o">.</span>
  <span class="nt">return</span> <span class="nt">self</span><span class="nc">.fit</span><span class="o">(</span><span class="nt">X</span><span class="o">,</span> <span class="o">**</span><span class="nt">fit_params</span><span class="o">)</span><span class="nc">.transform</span><span class="o">(</span><span class="nt">X</span><span class="o">)</span>
<span class="o">/</span><span class="nt">home</span><span class="o">/</span><span class="nt">paperspace</span><span class="o">/</span><span class="nt">anaconda3</span><span class="o">/</span><span class="nt">envs</span><span class="o">/</span><span class="nt">fastaiv1</span><span class="o">/</span><span class="nt">lib</span><span class="o">/</span><span class="nt">python3</span><span class="nc">.7</span><span class="o">/</span><span class="nt">site-packages</span><span class="o">/</span><span class="nt">sklearn</span><span class="o">/</span><span class="nt">preprocessing</span><span class="o">/</span><span class="nt">data</span><span class="nc">.py</span><span class="nd">:323</span><span class="o">:</span> <span class="nt">DataConversionWarning</span><span class="o">:</span> <span class="nt">Data</span> <span class="nt">with</span> <span class="nt">input</span> <span class="nt">dtype</span> <span class="nt">int8</span><span class="o">,</span> <span class="nt">int16</span><span class="o">,</span> <span class="nt">int32</span><span class="o">,</span> <span class="nt">int64</span><span class="o">,</span> <span class="nt">float64</span> <span class="nt">were</span> <span class="nt">all</span> <span class="nt">converted</span> <span class="nt">to</span> <span class="nt">float64</span> <span class="nt">by</span> <span class="nt">MinMaxScaler</span><span class="o">.</span>
  <span class="nt">return</span> <span class="nt">self</span><span class="nc">.partial_fit</span><span class="o">(</span><span class="nt">X</span><span class="o">,</span> <span class="nt">y</span><span class="o">)</span>
<span class="o">/</span><span class="nt">home</span><span class="o">/</span><span class="nt">paperspace</span><span class="o">/</span><span class="nt">anaconda3</span><span class="o">/</span><span class="nt">envs</span><span class="o">/</span><span class="nt">fastaiv1</span><span class="o">/</span><span class="nt">lib</span><span class="o">/</span><span class="nt">python3</span><span class="nc">.7</span><span class="o">/</span><span class="nt">site-packages</span><span class="o">/</span><span class="nt">scipy</span><span class="o">/</span><span class="nt">stats</span><span class="o">/</span><span class="nt">stats</span><span class="nc">.py</span><span class="nd">:1713</span><span class="o">:</span> <span class="nt">FutureWarning</span><span class="o">:</span> <span class="nt">Using</span> <span class="nt">a</span> <span class="nt">non-tuple</span> <span class="nt">sequence</span> <span class="nt">for</span> <span class="nt">multidimensional</span> <span class="nt">indexing</span> <span class="nt">is</span> <span class="nt">deprecated</span><span class="o">;</span> <span class="nt">use</span> <span class="err">`</span><span class="nt">arr</span><span class="cp">[</span><span class="nx">tuple</span><span class="p">(</span><span class="nx">seq</span><span class="p">)</span><span class="cp">]</span><span class="err">`</span> <span class="nt">instead</span> <span class="nt">of</span> <span class="err">`</span><span class="nt">arr</span><span class="cp">[</span><span class="nx">seq</span><span class="cp">]</span><span class="err">`</span><span class="o">.</span> <span class="nt">In</span> <span class="nt">the</span> <span class="nt">future</span> <span class="nt">this</span> <span class="nt">will</span> <span class="nt">be</span> <span class="nt">interpreted</span> <span class="nt">as</span> <span class="nt">an</span> <span class="nt">array</span> <span class="nt">index</span><span class="o">,</span> <span class="err">`</span><span class="nt">arr</span><span class="cp">[</span><span class="nx">np.array</span><span class="p">(</span><span class="nx">seq</span><span class="p">)</span><span class="cp">]</span><span class="err">`</span><span class="o">,</span> <span class="nt">which</span> <span class="nt">will</span> <span class="nt">result</span> <span class="nt">either</span> <span class="nt">in</span> <span class="nt">an</span> <span class="nt">error</span> <span class="nt">or</span> <span class="nt">a</span> <span class="nt">different</span> <span class="nt">result</span><span class="o">.</span>
  <span class="nt">return</span> <span class="nt">np</span><span class="nc">.add.reduce</span><span class="o">(</span><span class="nt">sorted</span><span class="cp">[</span><span class="nx">indexer</span><span class="cp">]</span> <span class="o">*</span> <span class="nt">weights</span><span class="o">,</span> <span class="nt">axis</span><span class="o">=</span><span class="nt">axis</span><span class="o">)</span> <span class="o">/</span> <span class="nt">sumval</span>
</pre></div>


<p><img alt="png" src="Punch-netflow-project_files/Punch-netflow-project_95_1.png"></p>
<h3>Making the data richer with feature extraction</h3>
<h4>One-hot-encoding</h4>
<p>Returning to the <code>SrcDevice</code> and <code>DstDevice</code> features, the 4 non-Comp/IP devices with no numbers associated with them are perfect for one-hot-encoding. The <code>Protocol</code>, with only 3 different values, is also a great candidate for one-hot-encoding.</p>
<div class="highlight"><pre><span class="n">train_df1</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;Comp&#39;</span><span class="p">,</span><span class="s">&#39;IP&#39;</span><span class="p">],</span><span class="n">noComp_orIP</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
    <span class="n">train_df1</span><span class="p">[</span><span class="n">f</span><span class="s">&#39;SrcDevice_{i}&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">train_df1</span><span class="p">[</span><span class="n">f</span><span class="s">&#39;DstDevice_{i}&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ind_src</span> <span class="o">=</span> <span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;SrcDevice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">f</span><span class="s">&#39;{i}&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">ind_dst</span> <span class="o">=</span> <span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;DstDevice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">f</span><span class="s">&#39;{i}&#39;</span><span class="p">)</span><span class="o">==</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">train_df1</span><span class="p">[</span><span class="n">f</span><span class="s">&#39;SrcDevice_{i}&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind_src</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">train_df1</span><span class="p">[</span><span class="n">f</span><span class="s">&#39;DstDevice_{i}&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind_dst</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s">&#39;Comp&#39;</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">==</span> <span class="s">&#39;IP&#39;</span><span class="p">:</span> <span class="c">#Replace 1 with actual Comp or IP value</span>
        <span class="n">train_df1</span><span class="p">[</span><span class="n">f</span><span class="s">&#39;SrcDevice_{i}&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind_src</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_df1</span><span class="p">[</span><span class="s">&#39;SrcDevice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind_src</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="n">f</span><span class="s">&#39;{i}&#39;</span><span class="p">)))</span>
        <span class="n">train_df1</span><span class="p">[</span><span class="n">f</span><span class="s">&#39;DstDevice_{i}&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind_dst</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_df1</span><span class="p">[</span><span class="s">&#39;DstDevice&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">ind_dst</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="n">f</span><span class="s">&#39;{i}&#39;</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_df1</span><span class="p">[</span><span class="s">&#39;Protocol&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">):</span>
    <span class="n">train_df1</span><span class="p">[</span><span class="n">f</span><span class="s">&#39;Protocol_{i}&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">train_df1</span><span class="p">[</span><span class="n">f</span><span class="s">&#39;Protocol_{i}&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">train_df</span><span class="p">[</span><span class="s">&#39;Protocol&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">train_df1</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;SrcDevice&#39;</span><span class="p">,</span><span class="s">&#39;DstDevice&#39;</span><span class="p">,</span><span class="s">&#39;Protocol&#39;</span><span class="p">],</span><span class="n">inplace</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">train_df1</span><span class="p">[</span><span class="s">&#39;SrcPort&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_df1</span><span class="p">[</span><span class="s">&#39;SrcPort&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="n">f</span><span class="s">&#39;Port&#39;</span><span class="p">)))</span>
<span class="n">train_df1</span><span class="p">[</span><span class="s">&#39;DstPort&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_df1</span><span class="p">[</span><span class="s">&#39;DstPort&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="n">f</span><span class="s">&#39;Port&#39;</span><span class="p">)))</span>
</pre></div>


<h4>Time-series Analysis (TSA)</h4>
<p>So far we have not really encoded any idea of 'normal' or 'abnormal' into our model.<br>
From Kitsune: An Ensemble of Autoencoders for Online Network Intrusion Detection (Mirsky 2018) </p>
<blockquote>
<p>Feature extraction is the process of obtaining or engineering a vector of values which describe a real world observation. In network anomaly detection, it is important to extract features which capture the context and purpose of each packet traversing the network. For example, consider a single TCP SYN packet. The packet may be a benign attempt to establish a connection with a server, or it may be one of millions of similar packets sent in an attempt to cause a denial of service attack (DoS).  <br /><br />
This is just one example of attacks where temporal-statistical features could help detect anomalies. The challenge with extracting these kinds of features from network traffic is that (1) packets from different channels (conversations) are interleaved, (2) there can be many channels at any given moment, (3) the packet arrival rate can be very high.</p>
</blockquote>
<p>We can begin to do this by adding rolling statistics of events and apply them to each feature. This way we will be able to check how each event and its features compare to a typical event in a window of x seconds.</p>
<p>Let's first look at the mean and standard deviation of the <code>Packets</code> and <code>Bytes</code> features for time windows of 1, 10 and 60 seconds into the past. This will add 24 features to our dataset.</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">FeatureExtractor</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">time_windows</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">time_windows</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
            <span class="n">dff</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">dff</span><span class="p">[</span><span class="s">&#39;datetime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">dff</span><span class="p">[</span><span class="s">&#39;Time&#39;</span><span class="p">],</span><span class="n">unit</span> <span class="o">=</span> <span class="s">&#39;s&#39;</span><span class="p">)</span>
            <span class="n">dff</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">dff</span><span class="p">[</span><span class="s">&#39;datetime&#39;</span><span class="p">]</span>
            <span class="n">tmp_mean</span> <span class="o">=</span> <span class="n">dff</span><span class="p">[</span><span class="n">f</span><span class="s">&#39;{i}&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">f</span><span class="s">&#39;{j}s&#39;</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">tmp_std</span> <span class="o">=</span>  <span class="n">dff</span><span class="p">[</span><span class="n">f</span><span class="s">&#39;{i}&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">f</span><span class="s">&#39;{j}s&#39;</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">tmp_mean</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span>
            <span class="n">tmp_std</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span>
            <span class="n">df</span><span class="p">[</span><span class="n">f</span><span class="s">&#39;{i}_mean{j}s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_mean</span>
            <span class="n">df</span><span class="p">[</span><span class="n">f</span><span class="s">&#39;{i}_std{j}s&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp_std</span>
</pre></div>


<p><strong>Future Work</strong>:One way to improve the Feature Extractor is to intialize the statistics with a typical stream of data instead of just zero.</p>
<div class="highlight"><pre><span class="n">train_df2</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;SrcPackets&#39;</span><span class="p">,</span><span class="s">&#39;DstPackets&#39;</span><span class="p">,</span><span class="s">&#39;SrcBytes&#39;</span><span class="p">,</span><span class="s">&#39;DstBytes&#39;</span><span class="p">]</span>
<span class="n">time_windows</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">60</span><span class="p">]</span>
<span class="n">FeatureExtractor</span><span class="p">(</span><span class="n">train_df2</span><span class="p">,</span><span class="n">features</span><span class="p">,</span><span class="n">time_windows</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>SrcPackets 1
SrcPackets 10
SrcPackets 60
DstPackets 1
DstPackets 10
DstPackets 60
SrcBytes 1
SrcBytes 10
SrcBytes 60
DstBytes 1
DstBytes 10
DstBytes 60
</pre></div>


<h4>Entity Embedding for categorical variables.</h4>
<p><strong>Future work</strong> Since our categorical variables have such high cardinality, it might be useful to create an <strong>embedding vector</strong> for each of the ID numbers that is of a significantly lower dimension than the original cardinality. By combining all the vectors together we will have an <strong>embedding matrix</strong>.</p>
<h4>Feature Mapper</h4>
<p><strong>Future work</strong> Let's use agglomerative hierarchical clustering to see if any of our features are redundant.</p>
<h2>Testing various Autoencoder Architectures</h2>
<h3>Imports and Utility Functions</h3>
<div class="highlight"><pre><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span>
<span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">optim</span>
<span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="kn">as</span> <span class="nn">F</span>
<span class="kn">from</span> <span class="nn">torch.autograd</span> <span class="kn">import</span> <span class="n">Variable</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">TensorDataset</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">RobustScaler</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>

<span class="c">#if not os.path.exists(&#39;./mlp_img&#39;):</span>
<span class="c">#    os.mkdir(&#39;./mlp_img&#39;)</span>

<span class="n">epochs</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">bs</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">lr</span> <span class="o">=</span> <span class="mf">1e-3</span>
<span class="n">loss_func</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">binary_cross_entropy</span>
<span class="n">dev</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span>
    <span class="s">&quot;cuda&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s">&quot;cpu&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="n">train_ds</span><span class="p">,</span> <span class="n">valid_ds</span><span class="p">,</span> <span class="n">bs</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="n">DataLoader</span><span class="p">(</span><span class="n">train_ds</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">bs</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="n">DataLoader</span><span class="p">(</span><span class="n">valid_ds</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">bs</span> <span class="o">*</span> <span class="mi">2</span><span class="p">),</span>
    <span class="p">)</span>

<span class="k">def</span> <span class="nf">loss_batch</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">loss_func</span><span class="p">,</span> <span class="n">xb</span><span class="p">,</span> <span class="n">yb</span><span class="p">,</span> <span class="n">opt</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_func</span><span class="p">(</span><span class="n">model</span><span class="p">(</span><span class="n">xb</span><span class="p">),</span> <span class="n">yb</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">opt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="n">opt</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
        <span class="n">opt</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="nb">len</span><span class="p">(</span><span class="n">xb</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">fit</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">loss_func</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">train_dl</span><span class="p">,</span> <span class="n">valid_dl</span><span class="p">):</span>
    <span class="n">val_loss_hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">epochs</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
        <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">xb</span><span class="p">,</span> <span class="n">yb</span> <span class="ow">in</span> <span class="n">train_dl</span><span class="p">:</span>
            <span class="n">loss_batch</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">loss_func</span><span class="p">,</span> <span class="n">xb</span><span class="p">,</span> <span class="n">yb</span><span class="p">,</span> <span class="n">opt</span><span class="p">)</span>

        <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="n">losses</span><span class="p">,</span> <span class="n">nums</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="o">*</span><span class="p">[</span><span class="n">loss_batch</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">loss_func</span><span class="p">,</span> <span class="n">xb</span><span class="p">,</span> <span class="n">yb</span><span class="p">)</span> <span class="k">for</span> <span class="n">xb</span><span class="p">,</span> <span class="n">yb</span> <span class="ow">in</span> <span class="n">valid_dl</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="n">val_loss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">losses</span><span class="p">,</span> <span class="n">nums</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nums</span><span class="p">)</span>
        <span class="n">val_loss_hist</span><span class="p">[</span><span class="n">epoch</span><span class="p">]</span> <span class="o">=</span> <span class="n">val_loss</span>
        <span class="k">print</span><span class="p">(</span><span class="n">epoch</span><span class="p">,</span> <span class="n">val_loss</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">val_loss_hist</span>

<span class="k">class</span> <span class="nc">Lambda</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dev</span><span class="p">),</span> <span class="n">y</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">WrappedDataLoader</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dl</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dl</span> <span class="o">=</span> <span class="n">dl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">func</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dl</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">batches</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dl</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">batches</span><span class="p">:</span>
            <span class="k">yield</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">b</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span class="k">def</span> <span class="nf">check_cats</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cat_vars</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cat_vars</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="n">f</span><span class="s">&#39;{i}&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">f</span><span class="s">&#39;{i}&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">&#39;category&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">codes</span>
    <span class="k">return</span> <span class="n">data</span>
<span class="n">DIR</span> <span class="o">=</span> <span class="s">&quot;../input&quot;</span>

<span class="n">colnames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Time&#39;</span><span class="p">,</span> <span class="s">&#39;Duration&#39;</span><span class="p">,</span> <span class="s">&#39;SrcDevice&#39;</span><span class="p">,</span> <span class="s">&#39;DstDevice&#39;</span><span class="p">,</span> <span class="s">&#39;Protocol&#39;</span><span class="p">,</span> <span class="s">&#39;SrcPort&#39;</span><span class="p">,</span> <span class="s">&#39;DstPort&#39;</span><span class="p">,</span> <span class="s">&#39;SrcPackets&#39;</span><span class="p">,</span> 
       <span class="s">&#39;DstPackets&#39;</span><span class="p">,</span> <span class="s">&#39;SrcBytes&#39;</span><span class="p">,</span> <span class="s">&#39;DstBytes&#39;</span><span class="p">]</span>
<span class="n">cat_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;SrcDevice&#39;</span><span class="p">,</span> <span class="s">&#39;DstDevice&#39;</span><span class="p">,</span><span class="s">&#39;Protocol&#39;</span><span class="p">,</span><span class="s">&#39;SrcPort&#39;</span><span class="p">,</span> <span class="s">&#39;DstPort&#39;</span><span class="p">]</span>
<span class="n">cont_vars</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Time&#39;</span><span class="p">,</span> <span class="s">&#39;Duration&#39;</span><span class="p">,</span> <span class="s">&#39;SrcPackets&#39;</span><span class="p">,</span> <span class="s">&#39;DstPackets&#39;</span><span class="p">,</span> <span class="s">&#39;SrcBytes&#39;</span><span class="p">,</span> <span class="s">&#39;DstBytes&#39;</span><span class="p">]</span>
<span class="n">train_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">DIR</span><span class="p">,</span> <span class="s">&#39;netflow_day-03.csv&#39;</span><span class="p">),</span><span class="n">names</span> <span class="o">=</span> <span class="n">colnames</span><span class="p">)</span>
<span class="n">train_df</span> <span class="o">=</span> <span class="n">check_cats</span><span class="p">(</span><span class="n">train_df</span><span class="p">,</span><span class="n">cat_vars</span><span class="p">)</span>
</pre></div>


<h3>Just to get a feel for our data and model performance, I'll only be using ~2% of the data to allow for quick iterations. Our goal is to see what works initally and then when training a final model I'll use all of the data.</h3>
<div class="highlight"><pre><span class="n">x_train</span><span class="p">,</span> <span class="n">x_valid</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_valid</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">scaled_df1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">100000</span><span class="p">],</span> <span class="n">scaled_df1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">100000</span><span class="p">],</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.33</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">x_valid</span><span class="p">,</span> <span class="n">y_valid</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">,</span> <span class="p">(</span><span class="n">x_train</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">y_train</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">x_valid</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">y_valid</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
<span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">x_valid</span><span class="p">,</span> <span class="n">y_valid</span> <span class="o">=</span> <span class="n">x_train</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span> <span class="n">y_train</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span> <span class="n">x_valid</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span> <span class="n">y_valid</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
<span class="n">train_ds</span> <span class="o">=</span> <span class="n">TensorDataset</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">valid_ds</span> <span class="o">=</span> <span class="n">TensorDataset</span><span class="p">(</span><span class="n">x_valid</span><span class="p">,</span> <span class="n">y_valid</span><span class="p">)</span>
<span class="n">train_dl</span><span class="p">,</span> <span class="n">valid_dl</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">train_ds</span><span class="p">,</span> <span class="n">valid_ds</span><span class="p">,</span> <span class="n">bs</span><span class="p">)</span>
<span class="n">train_dl</span> <span class="o">=</span> <span class="n">WrappedDataLoader</span><span class="p">(</span><span class="n">train_dl</span><span class="p">,</span> <span class="n">preprocess</span><span class="p">)</span>
<span class="n">valid_dl</span> <span class="o">=</span> <span class="n">WrappedDataLoader</span><span class="p">(</span><span class="n">valid_dl</span><span class="p">,</span> <span class="n">preprocess</span><span class="p">)</span>
</pre></div>


<h3>Basic AutoEncoder (AE)</h3>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">autoencoder</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">autoencoder</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">())</span> 

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>
</pre></div>


<h4>For our initial run, let's try training the AE using the standard Stochastic Gradient Descent (SGD) optimization algorithm.</h4>
<div class="highlight"><pre><span class="n">model</span> <span class="o">=</span> <span class="n">autoencoder</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>
<span class="n">opt</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
<span class="n">simpleAE</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">loss_func</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">train_dl</span><span class="p">,</span> <span class="n">valid_dl</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>0 0.6153640248992226
1 0.5632328183867714
2 0.521731213497393
3 0.48840221228744046
4 0.4613625860214233
5 0.43919258066379663
6 0.42081355727080144
7 0.40540852949836037
8 0.392343591075955
9 0.3811262700918949
10 0.371357077107285
11 0.36269724823489335
12 0.3549058718753583
13 0.3477984815799829
14 0.34122927554448446
15 0.335087068752809
16 0.32927751234083463
17 0.32372928273316587
18 0.31840084727605183
19 0.3132779013893821
20 0.30835604749303874
21 0.30364818929180953
22 0.29918292765183885
23 0.29499714277729844
24 0.29111959272442445
25 0.28757020660602683
26 0.2843516824967933
27 0.28145706274292687
28 0.27886660063627994
29 0.2765542323661573
</pre></div>


<h4>When utilizing the Adam optimization algorithm instead, we see that our loss starts off much lower and ultimately achieves a better result.</h4>
<div class="highlight"><pre><span class="n">model</span> <span class="o">=</span> <span class="n">autoencoder</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>
<span class="n">opt1</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
<span class="n">simpleAE1</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">loss_func</span><span class="p">,</span> <span class="n">opt1</span><span class="p">,</span> <span class="n">train_dl</span><span class="p">,</span> <span class="n">valid_dl</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>0 0.3132772430289875
1 0.27298690352295385
2 0.26548837280273435
3 0.2561405701709516
4 0.24500035896807007
5 0.23917841724554698
6 0.23640931301044696
7 0.22925565374981274
8 0.2199682547901616
9 0.21693617815321142
10 0.2149911564985911
11 0.21362458565740874
12 0.21265988235762626
13 0.21197906290039872
14 0.2114728673732642
15 0.21104865649974708
16 0.2106399353056243
17 0.21023554500305291
18 0.2098258723598538
19 0.2094674902973753
20 0.20916657164241328
21 0.20891935854247123
22 0.20872451052882454
23 0.20859452519633553
24 0.2084934107245821
25 0.20842122670014698
26 0.20837569244702658
27 0.20834395785042734
28 0.20831816785263294
29 0.20830102947986487
</pre></div>


<h4>By changing the size of our bottleneck, we are expanding/limiting the space our network will use to find latent representations of our features. For now, increasing the size seems to only help marginally. However, we will want to return to this hyperparameter when we engineer more features in the future.</h4>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">autoencoder1</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">autoencoder1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">())</span> 

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">autoencoder1</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>
<span class="n">opt1</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
<span class="n">SimpleAE2</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">loss_func</span><span class="p">,</span> <span class="n">opt1</span><span class="p">,</span> <span class="n">train_dl</span><span class="p">,</span> <span class="n">valid_dl</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>0 0.27842848107309054
1 0.2424553751078519
2 0.22034330931938056
3 0.2125227058836908
4 0.2091995555559794
5 0.20629277456890452
6 0.20423057547121337
7 0.20225441743749561
8 0.2000320770451517
9 0.19847749503814813
10 0.19774435007572175
11 0.19735746824741363
12 0.1971329365788084
13 0.19700006837555856
14 0.19692712545756139
15 0.19688325585018504
16 0.19685634627847962
17 0.19684289213744077
18 0.19683339035149777
19 0.19682246895269914
20 0.19681916312376657
21 0.19681775667450646
22 0.19682014381524288
23 0.19681429224664515
24 0.1968093104543108
25 0.19681130621288762
26 0.19680515278108193
27 0.19680367324930248
28 0.19680531917557573
29 0.19681047119877554
</pre></div>


<h4>QUESTION: What size should we select for the latent representation of our data?</h4>
<h3>Deep AutoEncoder (aka Stacked AutoEncoder, SAE)</h3>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">deep_autoencoder</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">deep_autoencoder</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="bp">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>
</pre></div>


<h4>Now I'll create an AE that has multiple hidden layers, a deep AE. Let's first start with a model that has 2 hidden layers. This doesn't seem to do much better than our one-layer AE but again, might be useful if we incorporate more features in the future.</h4>
<div class="highlight"><pre><span class="n">model</span> <span class="o">=</span> <span class="n">deep_autoencoder</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>
<span class="n">opt1</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
<span class="n">deepAE</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">loss_func</span><span class="p">,</span> <span class="n">opt1</span><span class="p">,</span> <span class="n">train_dl</span><span class="p">,</span> <span class="n">valid_dl</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>0 0.2449271744598042
1 0.22742869142330055
2 0.21516548670060706
3 0.2077671935377699
4 0.2028120079979752
5 0.20213690534866216
6 0.200944096066735
7 0.19925501989595817
8 0.19780528188835492
9 0.1971274009401148
10 0.1968309831944379
11 0.19652490559852484
12 0.1962942510987773
13 0.19614683185562942
14 0.19603187960566895
15 0.19594012701872623
16 0.19582038521766662
17 0.19572626200589266
18 0.19565712436040242
19 0.19555748596335903
20 0.19550040659759985
21 0.19545797579577476
22 0.1954013790434057
23 0.19536583811947794
24 0.19534382763414673
25 0.19530811882019042
26 0.19530282218528516
27 0.19527743303414546
28 0.19524949955579007
29 0.1952263595046419
</pre></div>


<h4>Another option is to have 'overcomplete' layers. We can balloon the size of the first layer and shrink it back down. The simpler, 2 layer AE above does a better job so this doesn't seem like a promising avenue to continue down further.</h4>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">deep_autoencoder1</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">deep_autoencoder</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="bp">True</span><span class="p">),</span> 
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> 
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="bp">True</span><span class="p">),</span> 
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="bp">True</span><span class="p">),</span> 
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> 
            <span class="n">nn</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>
</pre></div>


<div class="highlight"><pre><span class="n">model</span> <span class="o">=</span> <span class="n">deep_autoencoder</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>
<span class="n">opt1</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
<span class="n">deepAE1</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">loss_func</span><span class="p">,</span> <span class="n">opt1</span><span class="p">,</span> <span class="n">train_dl</span><span class="p">,</span> <span class="n">valid_dl</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>0 0.2650241525100939
1 0.23482537920186014
2 0.21984392593123697
3 0.21350352708137396
4 0.20568819431825117
5 0.20219772437847022
6 0.20110394136110943
7 0.20012424728364656
8 0.19942686419053512
9 0.19796628739978328
10 0.19645627458529039
11 0.1958876735911225
12 0.19568070779424726
13 0.19561183846358096
14 0.1956282062964006
15 0.19557593305544418
16 0.1955740126985492
17 0.19555451732332058
18 0.19555348258668726
19 0.1955339559063767
20 0.1955322019042391
21 0.19553729743668527
22 0.19552998865011967
23 0.19553163955428385
24 0.1955169496716875
25 0.19551997378016964
26 0.19551090997276885
27 0.19550259295015623
28 0.19551545627189404
29 0.19549637895280664
</pre></div>


<h3>Convolutional AutoEncoder (CAE)</h3>
<h4>Future work! See below for a rough schematic of a planned implementation.</h4>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">conv_autoencoder</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">conv_autoencoder</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>  <span class="c"># b, 16, 10, 10</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">MaxPool1d</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>  <span class="c"># b, 16, 5, 5</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Conv1d</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>  <span class="c"># b, 8, 3, 3</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">MaxPool1d</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># b, 8, 2, 2</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ConvTranspose1d</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>  <span class="c"># b, 16, 5, 5</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ConvTranspose1d</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>  <span class="c"># b, 8, 15, 15</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ConvTranspose1d</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>  <span class="c"># b, 1, 28, 28</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>
</pre></div>


<div class="highlight"><pre><span class="n">train_dl_w</span> <span class="o">=</span> <span class="n">WrappedDataLoader</span><span class="p">(</span><span class="n">train_dl</span><span class="p">,</span> <span class="n">preprocess</span><span class="p">)</span>
<span class="n">valid_dl_w</span> <span class="o">=</span> <span class="n">WrappedDataLoader</span><span class="p">(</span><span class="n">valid_dl</span><span class="p">,</span> <span class="n">preprocess</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">conv_autoencoder</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>
<span class="n">convAE</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">loss_func</span><span class="p">,</span> <span class="n">opt1</span><span class="p">,</span> <span class="n">train_dl_w</span><span class="p">,</span> <span class="n">valid_dl_w</span><span class="p">)</span>
</pre></div>


<h3>Comparison of AE architectures with default dataset (no feature engineering)</h3>
<div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">sub</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">sub</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">epochs</span><span class="p">),</span><span class="n">simpleAE</span><span class="p">,</span>  <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;Simple w/ SGD&#39;</span><span class="p">)</span>
<span class="n">sub</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">epochs</span><span class="p">),</span><span class="n">simpleAE1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;Simple w/ Adam&#39;</span><span class="p">)</span>
<span class="n">sub</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">epochs</span><span class="p">),</span><span class="n">deepAE</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;Deep (2-layer) w/ Adam&#39;</span><span class="p">)</span>
<span class="n">sub</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">epochs</span><span class="p">),</span><span class="n">deepAE1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;Deep (6-layer) w/ Adam&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre>&lt;matplotlib.legend.Legend at 0x7f6b42de8940&gt;
</pre></div>


<p><img alt="png" src="Punch-netflow-project_files/Punch-netflow-project_137_1.png"></p>
<h3>Comparison of AE architectures with feature engineered dataset</h3>
<h4>Basic AE w/ TSA features</h4>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">autoencoder2</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">autoencoder2</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">35</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">())</span> 

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>
<span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">35</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dev</span><span class="p">),</span> <span class="n">y</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span class="n">x_train</span><span class="p">,</span> <span class="n">x_valid</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_valid</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">scaled_df1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">100000</span><span class="p">],</span> <span class="n">scaled_df1</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">100000</span><span class="p">],</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.33</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">x_valid</span><span class="p">,</span> <span class="n">y_valid</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">,</span> <span class="p">(</span><span class="n">x_train</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">y_train</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">x_valid</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">y_valid</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
<span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">x_valid</span><span class="p">,</span> <span class="n">y_valid</span> <span class="o">=</span> <span class="n">x_train</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span> <span class="n">y_train</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span> <span class="n">x_valid</span><span class="o">.</span><span class="n">float</span><span class="p">(),</span> <span class="n">y_valid</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
<span class="n">train_ds</span> <span class="o">=</span> <span class="n">TensorDataset</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">valid_ds</span> <span class="o">=</span> <span class="n">TensorDataset</span><span class="p">(</span><span class="n">x_valid</span><span class="p">,</span> <span class="n">y_valid</span><span class="p">)</span>
<span class="n">train_dl</span><span class="p">,</span> <span class="n">valid_dl</span> <span class="o">=</span> <span class="n">get_data</span><span class="p">(</span><span class="n">train_ds</span><span class="p">,</span> <span class="n">valid_ds</span><span class="p">,</span> <span class="n">bs</span><span class="p">)</span>
<span class="n">train_dl</span> <span class="o">=</span> <span class="n">WrappedDataLoader</span><span class="p">(</span><span class="n">train_dl</span><span class="p">,</span> <span class="n">preprocess</span><span class="p">)</span>
<span class="n">valid_dl</span> <span class="o">=</span> <span class="n">WrappedDataLoader</span><span class="p">(</span><span class="n">valid_dl</span><span class="p">,</span> <span class="n">preprocess</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span class="n">model</span> <span class="o">=</span> <span class="n">autoencoder2</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>
<span class="n">opt1</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
<span class="n">simpleAE_ed</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">loss_func</span><span class="p">,</span> <span class="n">opt1</span><span class="p">,</span> <span class="n">train_dl</span><span class="p">,</span> <span class="n">valid_dl</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>0 0.15542524325486384
1 0.1330017716595621
2 0.12358071852994687
3 0.12134318643627745
4 0.12013640852949836
5 0.11922035816040906
6 0.1186038601488778
7 0.11830568287769953
8 0.11817351314515778
9 0.11809839636629278
10 0.11803493072950479
11 0.118003826110652
12 0.11796236093477769
13 0.11794244261040832
14 0.11791596555709839
15 0.11789782470103466
16 0.11788164298642766
17 0.11786410925785701
18 0.1178481928651983
19 0.11783261449770494
20 0.11781676309217107
21 0.11780566596984864
22 0.11778696250373667
23 0.11777133213570623
24 0.11775690714156989
25 0.11774744177406485
26 0.11774040185863321
27 0.11772692710883689
28 0.11772219492630526
29 0.11770839673100096
</pre></div>


<div class="highlight"><pre><span class="k">class</span> <span class="nc">autoencoder3</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">autoencoder3</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">35</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">())</span> 

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>
<span class="k">def</span> <span class="nf">preprocess</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">35</span><span class="p">)</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dev</span><span class="p">),</span> <span class="n">y</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">autoencoder3</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>
<span class="n">opt1</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
<span class="n">simpleAE_ed1</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">loss_func</span><span class="p">,</span> <span class="n">opt1</span><span class="p">,</span> <span class="n">train_dl</span><span class="p">,</span> <span class="n">valid_dl</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>0 0.18049194024548387
1 0.15102098090359659
2 0.1473470046339613
3 0.143951437588894
4 0.13999235530333085
5 0.1366622529969071
6 0.13426986752134382
7 0.1325131246248881
8 0.13121682799223697
9 0.13023262498595498
10 0.12944078761158567
11 0.12880684867049708
12 0.1282730374841979
13 0.12780357990842878
14 0.12739020001165793
15 0.12700787126656735
16 0.1266632669802868
17 0.12634942066669463
18 0.12608273115663818
19 0.12587054110657084
20 0.12572116792201996
21 0.12558745316664377
22 0.1255006782141599
23 0.12543083710381478
24 0.12537497831113412
25 0.12533319084210828
26 0.12530713788307074
27 0.12527308274399152
28 0.1252579463900942
29 0.12523770618799962
</pre></div>


<h4>Deep AutoEncoder w/ TSA features</h4>
<div class="highlight"><pre><span class="k">class</span> <span class="nc">deep_autoencoder1</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">deep_autoencoder1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="mi">26</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="bp">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">26</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">26</span><span class="p">,</span> <span class="mi">35</span><span class="p">),</span>
            <span class="n">nn</span><span class="o">.</span><span class="n">Sigmoid</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">deep_autoencoder1</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>
<span class="n">opt1</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="mf">1e-5</span><span class="p">)</span>
<span class="n">deepAE_ed</span> <span class="o">=</span> <span class="n">fit</span><span class="p">(</span><span class="n">epochs</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">loss_func</span><span class="p">,</span> <span class="n">opt1</span><span class="p">,</span> <span class="n">train_dl</span><span class="p">,</span> <span class="n">valid_dl</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>0 0.14267463051550316
1 0.13841716249422595
2 0.12931717374469295
3 0.12356641965923887
4 0.12296843826228922
5 0.12272117885856917
6 0.1225782561211875
7 0.12246075998472444
8 0.1223881917180437
9 0.12213705055641405
10 0.12176700847076648
11 0.1211470121939977
12 0.11976834000421292
13 0.11921178272818074
14 0.11903793139349331
15 0.11892726133447705
16 0.11888989595030293
17 0.11885944359230273
18 0.11882691781990457
19 0.11880519064267477
20 0.11877735575943282
21 0.11873244151743975
22 0.11870291563055732
23 0.11867264552911122
24 0.11859710764523708
25 0.11848349631193912
26 0.11834015336903658
27 0.11821681090918454
28 0.11815993258447358
29 0.11813407987717427
</pre></div>


<h4>Just by including out engineered TSA features, we've lowered the loss by nearly half!</h4>
<div class="highlight"><pre><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">sub</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">sub</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">epochs</span><span class="p">),</span><span class="n">simpleAE_ed</span><span class="p">,</span>  <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;SimpleAE w/ eng. feat.&#39;</span><span class="p">)</span>
<span class="n">sub</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">epochs</span><span class="p">),</span><span class="n">simpleAE_ed1</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;SimpleAE w/ eng. feat., diff. size&#39;</span><span class="p">)</span>
<span class="n">sub</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">epochs</span><span class="p">),</span><span class="n">deepAE_ed</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s">&#39;Deep (6-layer) w/ Adam&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre>&lt;matplotlib.legend.Legend at 0x7f539722af28&gt;
</pre></div>


<p><img alt="png" src="Punch-netflow-project_files/Punch-netflow-project_147_1.png"></p>
<h3>Improving the learning rate</h3>
<p><strong>Future work</strong></p>
<p>I want to implement Smith 2015's one cycle learning schedule, which incorporates a cylical learning rate (and momentum) annealing. This is already implemnted in the fastai wrapper.</p>
<h2>Future work</h2>
<ul>
<li>Entity Embedding for categorical values</li>
<li>2D Statistics (magnitude, radius, approx. covariance and correlation coefficient of 2 different streams). <strong>Question: How best to define different streams? Are these simply different time windows of the same stream?</strong></li>
<li>Feature Mapping with agglomerative hierarchical clustering</li>
<li>Implement a Convolutional AutoEncoder</li>
<li>Apply learning rate/momentum annealing</li>
<li>Incorporate host events dataset</li>
</ul>
<h2>Resources</h2>
<p>Good <a href="https://www.jeremyjordan.me/autoencoders/">resource</a> for autoencoders<br>
Good <a href="https://towardsdatascience.com/intuitively-understanding-variational-autoencoders-1bfe67eb5daf">resource</a> for variational autoencoders (VAEs)<br>
Outlook inspired by <a href="https://arxiv.org/pdf/1802.09089.pdf">Kitsune</a> paper (Mirsky 2018)<br>
Insight from Cyber Reboot's <a href="https://blog.cyberreboot.org/deep-session-learning-for-cyber-security-e7c0f6804b81">work</a> on using RNN autoencoders on network traffic data.<br>
Good <a href="https://towardsdatascience.com/deep-learning-structured-data-8d6a278f3088">resource</a> for embeddings of structured data.</p>
<div class="highlight"><pre>
</pre></div>
  </div>

  <hr class="small"></hr>
  <div class="article-sharing">
      <ul>
      <!-- Twitter Sharing
      ================================================================== -->
      <li><a href="https://twitter.com/share" class="twitter-share-button" data-via="Alex_Fitts">Tweet</a></li>

      <!-- Facebook Sharing
      ================================================================== -->
      <li><div class="fb-share-button"
          data-href="http://afitts.github.io/2019/01/26/netflow/"
          data-layout="button_count">
      </div></li>
      </ul>
    </div>


    <!-- Back to home
    ================================================================== -->
    <div class="back-to-home">
      <a href="/">← Back to Home</a>
    </div>
    <hr class="small"></hr>
  </div>
  <script>
    // hide ipython notebook cell numbers
  $('div.prompt').hide();
  </script>
		</section>
<!-- Navigation
================================================== -->
<footer class="twelve columns">
	<!-- <hr class="small"> -->
  <p>Generated with <a href="http://getpelican.com">Pelican</a>. Layout done with <a href="http://getskeleton.com">Skeleton</a>. Icons are <a href="http://fortawesome.github.com/Font-Awesome/">Font Awesome</a>. Hosted on <a href="http://aws.amazon.com/s3/">S3</a>.</p>
  <p>&copy; Copyright Alex Fitts, 2016 to present</p>
</footer>	</div><!-- container -->

<!-- Google Analytics
================================================== -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34295039-1']);
  _gaq.push(['_setDomainName', 'gregreda.com']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  <script type="text/javascript">
    $("a").on('click', function(e) {
      var url = $(this).attr("href");
      console.log(url);
      if (e.currentTarget.host != window.location.host) {
        _gaq.push(['_trackEvent', 'Outbound Links', e.currentTarget.host, url, 0]);
        if (e.metaKey || e.ctrlKey) {
          var newtab = true;
        }
        if (!newtab) {
          e.preventDefault();
          setTimeout('document.location = "' + url + '"', 100);
        }
      }
    });
  </script>
</body> <!-- End body -->

<!-- JavaScript
=================================================== -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script type="text/javascript" async src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

<!-- twitter.js
==================================================================== -->
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>  

<!-- Facebook SDK for JS
==================================================================== -->
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

</html>