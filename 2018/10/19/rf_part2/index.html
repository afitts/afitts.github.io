<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>

<!-- Extra Header for IPython Notebooks
================================================== -->
  <link href="//cdn-images.mailchimp.com/embedcode/slim-081711.css" rel="stylesheet" type="text/css">
  <style type="text/css">
    #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif;  width:500px;}
    /*
      Add your own MailChimp form style overrides in your site stylesheet or in this style block.
      We recommend moving this block and the preceding CSS link to the HEAD of your HTML file.
     */
  </style>

	<!-- Basic Page Needs
  ================================================== -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="google-site-verification" content="AgIAQN_qsniIQWOq659Bnhzx-LZts2FdgP1kLgtQg-k" />
  <meta name="google-site-verification" content="-wneVy0z_MWocNaXikWZzyTe__HZbZDCRfLYEJ1sAg8" />

  <title>How I learned to stop worrying and love Random Forests (Part 2)</title>

  <meta name="description" content="">
  <meta name="author" content="Alex Fitts">
  <meta name="copyright" content="&copy; Copyright Greg Reda, 2013 to Present">

  <!-- Mobile Specific Metas
  ================================================== -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- Fonts 
  ================================================== -->
  <link href='http://fonts.googleapis.com/css?family=Open+Sans|Merriweather|Source+Code+Pro' rel='stylesheet' type='text/css'>

  <!-- CSS
  ================================================== -->
  <link rel="stylesheet" href="/theme/css/style.min.css?cfc9322a">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

  <!-- Feeds
  ================================================== -->
  <link rel="alternate" type="application/atom+xml" href="http://afitts.github.io/feeds/all.atom.xml" title="Alex Fitts Full Atom Feed">

	<!-- Facebook Open Graph
  ================================================== -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="How I learned to stop worrying and love Random Forests (Part 2)">
  <meta property="og:url" content="http://afitts.github.io/2018/10/19/rf_part2/">
  <meta property="og:description" content="">
  <meta property="og:site_name" content="Alex Fitts">
  <meta property="og:image" content="http://afitts.github.io/theme/images/avatar.jpg">

  <!-- Twitter Cards
  ================================================== -->
  <meta name="twitter:card" content="summary">
  <meta name="twitter:site" content="@Alex_Fitts">
  <meta name="twitter:creator" content="@Alex_Fitts">
  <meta name="twitter:domain" content="gregreda.com">
  <meta name="twitter:image" content="http://afitts.github.io/theme/images/avatar.jpg">
  <meta name="twitter:title" content="How I learned to stop worrying and love Random Forests (Part 2)">
  <meta name="twitter:description" content="">

	<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->


	<!-- Favicons
	================================================== -->
	<link rel="shortcut icon" href="/theme/images/favicon.ico">
	<link rel="apple-touch-icon" href="/theme/images/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/theme/images/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/theme/images/apple-touch-icon-114x114.png">

</head>
<body>
	<!-- Primary Page Layout
	================================================== -->
	<div class="container">
<!-- Navigation
================================================== -->
<nav class="navbar">
  <div class="navbar-brand six columns"> <!-- Yes, I know this is a douchey class name -->
      <ul>
        <li>
          <a href="/" title="Home"><img id="logo" src="/theme/images/avatar.jpg"></a>
        </li>
        <li>
          <h1><a href="/" title="Home">Alex Fitts</a></h1>
        </li>
      </ul>
      <ul id="social-icons">
        <li>
          <a class="icon" href="https://twitter.com/Alex_Fitts" title="Twitter">
            <i class="fa fa-fw fa-twitter"></i>
          </a>
          </li>
        <li>
          <a class="icon" href="https://github.com/afitts" title="GitHub">
            <i class="fa fa-fw fa-github"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="https://www.linkedin.com/in/alex-fitts-64163b128/" title="LinkedIn">
            <i class="fa fa-fw fa-linkedin"></i>
          </a>
        </li>
      </ul> <!-- End social-icons ul -->
    </div> <!-- End navbar-brand -->

  <div class="navbar-links">
      <ul>
        <li><a href="/pub/">Publications</a></li>
        <li><a href="/talks/">Talks</a></li>
        <li><a href="/blog/">Blog</a></li>
	<li><a href="/pdfs/FittsResume.pdf">Resume</a></li>
        <!--        <li><a href="/coffee/">Coffee?</a></li> -->
      </ul> <!-- End navbar-links ul -->
    </div> <!-- End navbar-links -->
</nav> <!-- End navbar -->		<section id="content" class="twelve columns">

  <!-- Article Headers
  ================================================================== -->
  <h1 class="article-title"><a href="/2018/10/19/rf_part2/" title="Permalink to How I learned to stop worrying and love Random Forests (Part 2)">How I learned to stop worrying and love Random Forests (Part 2)</a></h1>
  <h5 class="article-date">October 19, 2018
  </h5>
  <hr class="small"></hr>

  <!-- Article Content
  ================================================================== -->
  <div class="article-content">
    <p>Hello and welcome back to our initial exploration into Random Forests! Today I'm going to spice a little bit of unsupervised learning into our analysis.  I'm also going to try a few interpretation techniques that can not only be useful for getting to know your data better but also for <strong>explaining</strong> why your model gives the results it does.</p>
<h2>Removing Redundant features with unsupervised learning</h2>
<p>One thing that makes this harder to interpret is if there are some variables with very similar meanings. Let's try to remove redundent features using some <strong>unsupervised learning</strong>; specifically we'll be using some <strong>hierarchical (or agglomerated) clustering</strong>. We'll do this by taking advantage of <a href="https://en.wikipedia.org/wiki/Spearman%27s_rank_correlation_coefficient">Spearman's rank correlation coefficient</a>. Spearman's correlation is the same thing as converting two variables to rank values and then running a standard Pearson's correlation on those ranked variables. When I say 'rank values' I simply mean ordering each independent (and associated dependent) variable in increasing order. Their place in this list is their 'rank'. Then a Pearson's correlation measures the linear corelation between these newly ranked independent and dependent variables. One can think of this as checking to see which ranked features have a increase correlated with an increase in the ranked response (<code>SalePrice</code>) and grouping those that are correlated in a similar fashion. Let's see how we do this analysis in python: </p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">scipy.cluster</span> <span class="kn">import</span> <span class="n">hierarchy</span> <span class="k">as</span> <span class="n">hc</span>
</pre></div>


<div class="highlight"><pre><span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">spearmanr</span><span class="p">(</span><span class="n">df_keep</span><span class="p">)</span><span class="o">.</span><span class="n">correlation</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">corr_condensed</span> <span class="o">=</span> <span class="n">hc</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">squareform</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">corr</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">hc</span><span class="o">.</span><span class="n">linkage</span><span class="p">(</span><span class="n">corr_condensed</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;average&#39;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">dendrogram</span> <span class="o">=</span> <span class="n">hc</span><span class="o">.</span><span class="n">dendrogram</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">df_keep</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span> <span class="n">leaf_font_size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="housing-prices-comp_files/housing-prices-comp_94_0.png"></p>
<div class="highlight"><pre><span class="n">corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">spearmanr</span><span class="p">(</span><span class="n">df_keep2</span><span class="p">)</span><span class="o">.</span><span class="n">correlation</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">corr_condensed</span> <span class="o">=</span> <span class="n">hc</span><span class="o">.</span><span class="n">distance</span><span class="o">.</span><span class="n">squareform</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">corr</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">hc</span><span class="o">.</span><span class="n">linkage</span><span class="p">(</span><span class="n">corr_condensed</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;average&#39;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">dendrogram</span> <span class="o">=</span> <span class="n">hc</span><span class="o">.</span><span class="n">dendrogram</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">df_keep2</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span> <span class="n">leaf_font_size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="housing-prices-comp_files/housing-prices-comp_95_0.png"></p>
<p>Doesn't look like there's much redundancy in the features of either one, though one worrisome aspect of both is the big blue split that occurs in both. There seems to be two major groupings in both sets of data which leads me to believe that some of these features are inextricably linked. Intuitively this would make sense, e.g. <code>GarageArea</code> and <code>GarageCars</code> must explain the same sort of aspect of the data, namely how big the garage is.</p>
<div class="highlight"><pre><span class="n">display_all</span><span class="p">(</span><span class="n">df_keep</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>OverallQual</th>
      <td>1460.0</td>
      <td>6.099315</td>
      <td>1.382997</td>
      <td>1.0</td>
      <td>5.00</td>
      <td>6.0</td>
      <td>7.00</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>GrLivArea</th>
      <td>1460.0</td>
      <td>1515.463699</td>
      <td>525.480383</td>
      <td>334.0</td>
      <td>1129.50</td>
      <td>1464.0</td>
      <td>1776.75</td>
      <td>5642.0</td>
    </tr>
    <tr>
      <th>YearBuilt</th>
      <td>1460.0</td>
      <td>1971.267808</td>
      <td>30.202904</td>
      <td>1872.0</td>
      <td>1954.00</td>
      <td>1973.0</td>
      <td>2000.00</td>
      <td>2010.0</td>
    </tr>
    <tr>
      <th>GarageArea</th>
      <td>1460.0</td>
      <td>472.980137</td>
      <td>213.804841</td>
      <td>0.0</td>
      <td>334.50</td>
      <td>480.0</td>
      <td>576.00</td>
      <td>1418.0</td>
    </tr>
    <tr>
      <th>TotalBsmtSF</th>
      <td>1460.0</td>
      <td>1057.429452</td>
      <td>438.705324</td>
      <td>0.0</td>
      <td>795.75</td>
      <td>991.5</td>
      <td>1298.25</td>
      <td>6110.0</td>
    </tr>
    <tr>
      <th>GarageCars</th>
      <td>1460.0</td>
      <td>1.767123</td>
      <td>0.747315</td>
      <td>0.0</td>
      <td>1.00</td>
      <td>2.0</td>
      <td>2.00</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>1stFlrSF</th>
      <td>1460.0</td>
      <td>1162.626712</td>
      <td>386.587738</td>
      <td>334.0</td>
      <td>882.00</td>
      <td>1087.0</td>
      <td>1391.25</td>
      <td>4692.0</td>
    </tr>
    <tr>
      <th>ExterQual</th>
      <td>1460.0</td>
      <td>3.539726</td>
      <td>0.693995</td>
      <td>1.0</td>
      <td>3.00</td>
      <td>4.0</td>
      <td>4.00</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>YearRemodAdd</th>
      <td>1460.0</td>
      <td>1984.865753</td>
      <td>20.645407</td>
      <td>1950.0</td>
      <td>1967.00</td>
      <td>1994.0</td>
      <td>2004.00</td>
      <td>2010.0</td>
    </tr>
    <tr>
      <th>FullBath</th>
      <td>1460.0</td>
      <td>1.565068</td>
      <td>0.550916</td>
      <td>0.0</td>
      <td>1.00</td>
      <td>2.0</td>
      <td>2.00</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>LotArea</th>
      <td>1460.0</td>
      <td>10516.828082</td>
      <td>9981.264932</td>
      <td>1300.0</td>
      <td>7553.50</td>
      <td>9478.5</td>
      <td>11601.50</td>
      <td>215245.0</td>
    </tr>
    <tr>
      <th>GarageQual</th>
      <td>1460.0</td>
      <td>4.594521</td>
      <td>1.262078</td>
      <td>0.0</td>
      <td>5.00</td>
      <td>5.0</td>
      <td>5.00</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>2ndFlrSF</th>
      <td>1460.0</td>
      <td>346.992466</td>
      <td>436.528436</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>0.0</td>
      <td>728.00</td>
      <td>2065.0</td>
    </tr>
    <tr>
      <th>BsmtFinSF1</th>
      <td>1460.0</td>
      <td>443.639726</td>
      <td>456.098091</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>383.5</td>
      <td>712.25</td>
      <td>5644.0</td>
    </tr>
    <tr>
      <th>BsmtQual</th>
      <td>1460.0</td>
      <td>3.178767</td>
      <td>0.998402</td>
      <td>0.0</td>
      <td>3.00</td>
      <td>3.0</td>
      <td>4.00</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>FireplaceQu</th>
      <td>1460.0</td>
      <td>1.969178</td>
      <td>2.037956</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>2.0</td>
      <td>3.00</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>OverallCond</th>
      <td>1460.0</td>
      <td>5.575342</td>
      <td>1.112799</td>
      <td>1.0</td>
      <td>5.00</td>
      <td>5.0</td>
      <td>6.00</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>Fireplaces</th>
      <td>1460.0</td>
      <td>0.613014</td>
      <td>0.644666</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>1.0</td>
      <td>1.00</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>LotFrontage</th>
      <td>1460.0</td>
      <td>69.863699</td>
      <td>22.027677</td>
      <td>21.0</td>
      <td>60.00</td>
      <td>69.0</td>
      <td>79.00</td>
      <td>313.0</td>
    </tr>
    <tr>
      <th>CentralAir</th>
      <td>1460.0</td>
      <td>1.934932</td>
      <td>0.246731</td>
      <td>1.0</td>
      <td>2.00</td>
      <td>2.0</td>
      <td>2.00</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>PavedDrive</th>
      <td>1460.0</td>
      <td>2.856164</td>
      <td>0.496592</td>
      <td>1.0</td>
      <td>3.00</td>
      <td>3.0</td>
      <td>3.00</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>ExterCond</th>
      <td>1460.0</td>
      <td>4.733562</td>
      <td>0.731807</td>
      <td>1.0</td>
      <td>5.00</td>
      <td>5.0</td>
      <td>5.00</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>Neighborhood</th>
      <td>1460.0</td>
      <td>13.251370</td>
      <td>6.013735</td>
      <td>1.0</td>
      <td>8.00</td>
      <td>13.0</td>
      <td>18.00</td>
      <td>25.0</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span class="n">display_all</span><span class="p">(</span><span class="n">df_keep2</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="s">&#39;all&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>OverallQual</th>
      <td>1460.0</td>
      <td>6.099315</td>
      <td>1.382997</td>
      <td>1.0</td>
      <td>5.00</td>
      <td>6.0</td>
      <td>7.00</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>GrLivArea</th>
      <td>1460.0</td>
      <td>1515.463699</td>
      <td>525.480383</td>
      <td>334.0</td>
      <td>1129.50</td>
      <td>1464.0</td>
      <td>1776.75</td>
      <td>5642.0</td>
    </tr>
    <tr>
      <th>YearBuilt</th>
      <td>1460.0</td>
      <td>1971.267808</td>
      <td>30.202904</td>
      <td>1872.0</td>
      <td>1954.00</td>
      <td>1973.0</td>
      <td>2000.00</td>
      <td>2010.0</td>
    </tr>
    <tr>
      <th>TotalBsmtSF</th>
      <td>1460.0</td>
      <td>1057.429452</td>
      <td>438.705324</td>
      <td>0.0</td>
      <td>795.75</td>
      <td>991.5</td>
      <td>1298.25</td>
      <td>6110.0</td>
    </tr>
    <tr>
      <th>GarageArea</th>
      <td>1460.0</td>
      <td>472.980137</td>
      <td>213.804841</td>
      <td>0.0</td>
      <td>334.50</td>
      <td>480.0</td>
      <td>576.00</td>
      <td>1418.0</td>
    </tr>
    <tr>
      <th>ExterQual_TA</th>
      <td>1460.0</td>
      <td>0.620548</td>
      <td>0.485417</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>1.0</td>
      <td>1.00</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1stFlrSF</th>
      <td>1460.0</td>
      <td>1162.626712</td>
      <td>386.587738</td>
      <td>334.0</td>
      <td>882.00</td>
      <td>1087.0</td>
      <td>1391.25</td>
      <td>4692.0</td>
    </tr>
    <tr>
      <th>GarageCars</th>
      <td>1460.0</td>
      <td>1.767123</td>
      <td>0.747315</td>
      <td>0.0</td>
      <td>1.00</td>
      <td>2.0</td>
      <td>2.00</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>LotArea</th>
      <td>1460.0</td>
      <td>10516.828082</td>
      <td>9981.264932</td>
      <td>1300.0</td>
      <td>7553.50</td>
      <td>9478.5</td>
      <td>11601.50</td>
      <td>215245.0</td>
    </tr>
    <tr>
      <th>BsmtFinSF1</th>
      <td>1460.0</td>
      <td>443.639726</td>
      <td>456.098091</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>383.5</td>
      <td>712.25</td>
      <td>5644.0</td>
    </tr>
    <tr>
      <th>GarageYrBlt</th>
      <td>1460.0</td>
      <td>1978.589041</td>
      <td>23.997022</td>
      <td>1900.0</td>
      <td>1962.00</td>
      <td>1980.0</td>
      <td>2001.00</td>
      <td>2010.0</td>
    </tr>
    <tr>
      <th>YearRemodAdd</th>
      <td>1460.0</td>
      <td>1984.865753</td>
      <td>20.645407</td>
      <td>1950.0</td>
      <td>1967.00</td>
      <td>1994.0</td>
      <td>2004.00</td>
      <td>2010.0</td>
    </tr>
    <tr>
      <th>2ndFlrSF</th>
      <td>1460.0</td>
      <td>346.992466</td>
      <td>436.528436</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>0.0</td>
      <td>728.00</td>
      <td>2065.0</td>
    </tr>
    <tr>
      <th>GarageQual_TA</th>
      <td>1460.0</td>
      <td>0.897945</td>
      <td>0.302824</td>
      <td>0.0</td>
      <td>1.00</td>
      <td>1.0</td>
      <td>1.00</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>OverallCond</th>
      <td>1460.0</td>
      <td>5.575342</td>
      <td>1.112799</td>
      <td>1.0</td>
      <td>5.00</td>
      <td>5.0</td>
      <td>6.00</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>LotFrontage</th>
      <td>1460.0</td>
      <td>69.863699</td>
      <td>22.027677</td>
      <td>21.0</td>
      <td>60.00</td>
      <td>69.0</td>
      <td>79.00</td>
      <td>313.0</td>
    </tr>
    <tr>
      <th>Fireplaces</th>
      <td>1460.0</td>
      <td>0.613014</td>
      <td>0.644666</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>1.0</td>
      <td>1.00</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>Neighborhood</th>
      <td>1460.0</td>
      <td>13.251370</td>
      <td>6.013735</td>
      <td>1.0</td>
      <td>8.00</td>
      <td>13.0</td>
      <td>18.00</td>
      <td>25.0</td>
    </tr>
    <tr>
      <th>ExterCond_Fa</th>
      <td>1460.0</td>
      <td>0.019178</td>
      <td>0.137198</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>0.0</td>
      <td>0.00</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>BsmtUnfSF</th>
      <td>1460.0</td>
      <td>567.240411</td>
      <td>441.866955</td>
      <td>0.0</td>
      <td>223.00</td>
      <td>477.5</td>
      <td>808.00</td>
      <td>2336.0</td>
    </tr>
    <tr>
      <th>FullBath</th>
      <td>1460.0</td>
      <td>1.565068</td>
      <td>0.550916</td>
      <td>0.0</td>
      <td>1.00</td>
      <td>2.0</td>
      <td>2.00</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>Let's look at the partial dependence to see if we can find any interactions between the features.</p>
<h2>Partial Dependence Plots</h2>
<p>So now we're at the point where we want to try and really understand the data better by taking advantage of our new trained model. We are going to use something called partial dependence. What we are going to do is we are going to find the features that are important and how they relate to the dependent variable. First let's look at a few univariate relationships.</p>
<div class="highlight"><pre><span class="n">df_keep2</span><span class="o">.</span><span class="n">to_feather</span><span class="p">(</span><span class="s">&#39;tmp/house-prices-ohe-trim&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span class="n">fi2</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>cols</th>
      <th>imp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>OverallQual</td>
      <td>0.368414</td>
    </tr>
    <tr>
      <th>1</th>
      <td>GrLivArea</td>
      <td>0.173185</td>
    </tr>
    <tr>
      <th>2</th>
      <td>YearBuilt</td>
      <td>0.085010</td>
    </tr>
    <tr>
      <th>3</th>
      <td>TotalBsmtSF</td>
      <td>0.056902</td>
    </tr>
    <tr>
      <th>9</th>
      <td>GarageArea</td>
      <td>0.042945</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1stFlrSF</td>
      <td>0.035206</td>
    </tr>
    <tr>
      <th>6</th>
      <td>BsmtFinSF1</td>
      <td>0.031514</td>
    </tr>
    <tr>
      <th>4</th>
      <td>GarageCars</td>
      <td>0.023275</td>
    </tr>
    <tr>
      <th>10</th>
      <td>LotArea</td>
      <td>0.022124</td>
    </tr>
    <tr>
      <th>12</th>
      <td>YearRemodAdd</td>
      <td>0.021555</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span class="n">df_raw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_feather</span><span class="p">(</span><span class="s">&#39;tmp/house-prices-raw&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span class="n">x_all</span> <span class="o">=</span> <span class="n">get_sample</span><span class="p">(</span><span class="n">df_raw</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
</pre></div>


<p>ggplot provides a great way of looking at univariate relationships. By adding standard error equals true (se=True), it also shows me the confidence interval of this smoother. loess stands for locally weighted regression which is this idea of doing lots of little mini regressions.</p>
<div class="highlight"><pre><span class="n">ggplot</span><span class="p">(</span><span class="n">x_all</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s">&#39;OverallQual&#39;</span><span class="p">,</span> <span class="s">&#39;SalePrice&#39;</span><span class="p">))</span><span class="o">+</span><span class="n">stat_smooth</span><span class="p">(</span><span class="n">se</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;loess&#39;</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="housing-prices-comp_files/housing-prices-comp_107_0.png"></p>
<div class="highlight"><pre>&lt;ggplot: (-9223363268887317700)&gt;
</pre></div>


<p>Looks like something occurs at an <code>OverallQual</code> of 6. The slope of the log of the sale price shifts to a higher value.</p>
<div class="highlight"><pre><span class="n">ggplot</span><span class="p">(</span><span class="n">x_all</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s">&#39;GrLivArea&#39;</span><span class="p">,</span> <span class="s">&#39;SalePrice&#39;</span><span class="p">))</span><span class="o">+</span><span class="n">stat_smooth</span><span class="p">(</span><span class="n">se</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;loess&#39;</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="housing-prices-comp_files/housing-prices-comp_109_0.png"></p>
<div class="highlight"><pre>&lt;ggplot: (8746504262043)&gt;
</pre></div>


<div class="highlight"><pre><span class="n">ggplot</span><span class="p">(</span><span class="n">x_all</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="s">&#39;YearBuilt&#39;</span><span class="p">,</span> <span class="s">&#39;SalePrice&#39;</span><span class="p">))</span><span class="o">+</span><span class="n">stat_smooth</span><span class="p">(</span><span class="n">se</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s">&#39;loess&#39;</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="housing-prices-comp_files/housing-prices-comp_110_0.png"></p>
<div class="highlight"><pre>&lt;ggplot: (8767967175088)&gt;
</pre></div>


<p>While all our previous univariate relationships were basically straight lines, here we have some odd behavior. The problem is that when you look at a univariate relationship like this, there is a whole lot of collinearity going on — a whole lot of interactions that are being lost. For example, why did the price drop? Is it actually because things made between 1920 and 1960 are less valuable? Or is it actually because most of them were also sold during that time and there was maybe a recession then? </p>
<p>So what we really want to be able to do is say “well, what’s the relationship between <code>SalePrice</code> and <code>YearBuilt</code> all other things being equal. “All other things being equal” basically means if we sold something in 1990 vs. 1920 and it was exactly the same thing to exactly the same person in exactly the same auction so on and so forth, what would have been the difference in price? We can do this by using a partial dependence plot (pdp for short). What this analysis does is takes a random sample of 500 rows from the training data, assigns each row a new <code>YearBuilt</code> and uses our random forest model to predict what the new <code>SalePrice</code>'s. We do this for the entire range of <code>YearBuilt</code> and we get the following plot:</p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">pdpbox</span> <span class="kn">import</span> <span class="n">pdp</span>
<span class="kn">from</span> <span class="nn">plotnine</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>


<div class="highlight"><pre><span class="n">x</span> <span class="o">=</span> <span class="n">get_sample</span><span class="p">(</span><span class="n">df_keep2</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span class="k">def</span> <span class="nf">plot_pdp</span><span class="p">(</span><span class="n">feat</span><span class="p">,</span> <span class="n">model_feat</span><span class="p">,</span> <span class="n">clusters</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">feat_name</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">feat_name</span> <span class="o">=</span> <span class="n">feat_name</span> <span class="ow">or</span> <span class="n">feat</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">pdp</span><span class="o">.</span><span class="n">pdp_isolate</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">model_feat</span><span class="p">,</span><span class="n">feat</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pdp</span><span class="o">.</span><span class="n">pdp_plot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">feat_name</span><span class="p">,</span> <span class="n">plot_lines</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> 
                        <span class="n">cluster</span><span class="o">=</span><span class="n">clusters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span> <span class="n">n_cluster_centers</span><span class="o">=</span><span class="n">clusters</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span class="n">model_feat</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span class="n">plot_pdp</span><span class="p">(</span><span class="s">&#39;YearBuilt&#39;</span><span class="p">,</span><span class="n">model_feat</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>(&lt;Figure size 1080x684 with 2 Axes&gt;,
 {&#39;title_ax&#39;: &lt;matplotlib.axes._subplots.AxesSubplot at 0x7f47446a77b8&gt;,
  &#39;pdp_ax&#39;: &lt;matplotlib.axes._subplots.AxesSubplot at 0x7f4746a282b0&gt;})
</pre></div>


<p><img alt="png" src="housing-prices-comp_files/housing-prices-comp_117_1.png"></p>
<p>Each blue line represents a different batch of 500 random samples while the black line is the average of all the lines. While this isn't a completely straight line, it appears much more linear than the U shape we saw above. Hence it would appear that the high <code>SalePrice</code> isn't because of a specific feature of these old houses, perhaps these are historical houses that hold some special connotation that isn't represented in the data. </p>
<p>While we're at it, let's see if we can better understand that kink that was in the <code>OverallQual</code> curve.</p>
<div class="highlight"><pre><span class="n">plot_pdp</span><span class="p">(</span><span class="s">&#39;OverallQual&#39;</span><span class="p">,</span><span class="n">model_feat</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>(&lt;Figure size 1080x684 with 2 Axes&gt;,
 {&#39;title_ax&#39;: &lt;matplotlib.axes._subplots.AxesSubplot at 0x7f474ce7dfd0&gt;,
  &#39;pdp_ax&#39;: &lt;matplotlib.axes._subplots.AxesSubplot at 0x7f474c6336a0&gt;})
</pre></div>


<p><img alt="png" src="housing-prices-comp_files/housing-prices-comp_120_1.png"></p>
<div class="highlight"><pre><span class="n">plot_pdp</span><span class="p">(</span><span class="s">&#39;OverallQual&#39;</span><span class="p">,</span><span class="n">model_feat</span><span class="p">,</span><span class="n">clusters</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>(&lt;Figure size 1080x684 with 2 Axes&gt;,
 {&#39;title_ax&#39;: &lt;matplotlib.axes._subplots.AxesSubplot at 0x7f474c8ec6d8&gt;,
  &#39;pdp_ax&#39;: &lt;matplotlib.axes._subplots.AxesSubplot at 0x7f474c88a160&gt;})
</pre></div>


<p><img alt="png" src="housing-prices-comp_files/housing-prices-comp_121_1.png"></p>
<p>All other things being equal, there does indeed appear to be something special about an <code>OverallQual</code> of 6. Most likely this feature is simply a shorthand for a number of other features. Let keep exploring the data.</p>
<div class="highlight"><pre><span class="n">plot_pdp</span><span class="p">(</span><span class="s">&#39;GrLivArea&#39;</span><span class="p">,</span><span class="n">model_feat</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>(&lt;Figure size 1080x684 with 2 Axes&gt;,
 {&#39;title_ax&#39;: &lt;matplotlib.axes._subplots.AxesSubplot at 0x7f474c83f9e8&gt;,
  &#39;pdp_ax&#39;: &lt;matplotlib.axes._subplots.AxesSubplot at 0x7f474c7f1748&gt;})
</pre></div>


<p><img alt="png" src="housing-prices-comp_files/housing-prices-comp_123_1.png"></p>
<p>The above plot makes it seem like <code>GrLivArea</code> should definitely be in log. After rerunning the feature importance, <code>GrLivArea</code> jumped from ~0.15 to ~0.24! Definitely seems like a good move. Now lets see the new plot:</p>
<div class="highlight"><pre><span class="n">plot_pdp</span><span class="p">(</span><span class="s">&#39;GrLivArea&#39;</span><span class="p">,</span><span class="n">model_feat</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>(&lt;Figure size 1080x684 with 2 Axes&gt;,
 {&#39;title_ax&#39;: &lt;matplotlib.axes._subplots.AxesSubplot at 0x7f474473bba8&gt;,
  &#39;pdp_ax&#39;: &lt;matplotlib.axes._subplots.AxesSubplot at 0x7f4744707b00&gt;})
</pre></div>


<p><img alt="png" src="housing-prices-comp_files/housing-prices-comp_125_1.png"></p>
<div class="highlight"><pre><span class="n">plot_pdp</span><span class="p">(</span><span class="s">&#39;TotalBsmtSF&#39;</span><span class="p">,</span><span class="n">model_feat</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre>(&lt;Figure size 1080x684 with 2 Axes&gt;,
 {&#39;title_ax&#39;: &lt;matplotlib.axes._subplots.AxesSubplot at 0x7f474415ac88&gt;,
  &#39;pdp_ax&#39;: &lt;matplotlib.axes._subplots.AxesSubplot at 0x7f47441afc18&gt;})
</pre></div>


<p><img alt="png" src="housing-prices-comp_files/housing-prices-comp_126_1.png"></p>
<p>Another one that could benefit from taking the log of the variable. In fact it looks like a number of the SF and Area variables can benefit from it.</p>
<div class="highlight"><pre><span class="n">df_trn2</span><span class="p">,</span> <span class="n">y_trn</span><span class="p">,</span> <span class="n">nas</span> <span class="o">=</span> <span class="n">proc_df</span><span class="p">(</span><span class="n">df_raw</span><span class="p">,</span> <span class="s">&#39;SalePrice&#39;</span><span class="p">,</span> <span class="n">max_n_cat</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_valid</span> <span class="o">=</span> <span class="n">split_vals</span><span class="p">(</span><span class="n">df_trn2</span><span class="p">,</span> <span class="n">n_trn</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_features</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">oob_score</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">m</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">print_score</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</pre></div>


<h2>Tree Interpreter</h2>
<div class="highlight"><pre>
</pre></div>
  </div>

  <hr class="small"></hr>
  <div class="article-sharing">
      <ul>
      <!-- Twitter Sharing
      ================================================================== -->
      <li><a href="https://twitter.com/share" class="twitter-share-button" data-via="Alex_Fitts">Tweet</a></li>

      <!-- Facebook Sharing
      ================================================================== -->
      <li><div class="fb-share-button"
          data-href="http://afitts.github.io/2018/10/19/rf_part2/"
          data-layout="button_count">
      </div></li>
      </ul>
    </div>


    <!-- Back to home
    ================================================================== -->
    <div class="back-to-home">
      <a href="/">← Back to Home</a>
    </div>
    <hr class="small"></hr>
  </div>
  <script>
    // hide ipython notebook cell numbers
  $('div.prompt').hide();
  </script>
		</section>
<!-- Navigation
================================================== -->
<footer class="twelve columns">
	<!-- <hr class="small"> -->
  <p>Generated with <a href="http://getpelican.com">Pelican</a>. Layout done with <a href="http://getskeleton.com">Skeleton</a>. Icons are <a href="http://fortawesome.github.com/Font-Awesome/">Font Awesome</a>. Hosted on <a href="http://aws.amazon.com/s3/">S3</a>.</p>
  <p>&copy; Copyright Alex Fitts, 2016 to present</p>
</footer>	</div><!-- container -->

<!-- Google Analytics
================================================== -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34295039-1']);
  _gaq.push(['_setDomainName', 'gregreda.com']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  <script type="text/javascript">
    $("a").on('click', function(e) {
      var url = $(this).attr("href");
      console.log(url);
      if (e.currentTarget.host != window.location.host) {
        _gaq.push(['_trackEvent', 'Outbound Links', e.currentTarget.host, url, 0]);
        if (e.metaKey || e.ctrlKey) {
          var newtab = true;
        }
        if (!newtab) {
          e.preventDefault();
          setTimeout('document.location = "' + url + '"', 100);
        }
      }
    });
  </script>
</body> <!-- End body -->

<!-- JavaScript
=================================================== -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script type="text/javascript" async src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

<!-- twitter.js
==================================================================== -->
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>  

<!-- Facebook SDK for JS
==================================================================== -->
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

</html>